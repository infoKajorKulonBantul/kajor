<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Desa Kajor Kulon</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:400,700"
      rel="stylesheet"
    />
<script>
  const APIURL = 'https://script.google.com/macros/s/AKfycbwCPj54cfK56riLDIZNo4DhseSQsbtpfuCKkfRWAUI3q8QSZfHHYT1wn0UkF9HXQvjg/exec';
  // GANTI URL di atas kalau kamu pakai Web App lain (sudah ada di kode kamu)

  // ðŸ”‘ API OpenAI untuk analisis gambar tumbuhan
  const OPENAI_API_KEY = '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';
</script>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwCPj54cfK5_6riLDIZNo4DhseSQsbtpfuCKkfRWA_UI3q8QSZfHHYT1wn0UkF9HXQvjg/exec'; // GANTI DENGAN WEB_APP_URL
// GLOBAL CRUD FUNCTIONS
async function apiBaca(sheetName) {
  const params = new URLSearchParams({action: 'baca', sheet: sheetName});
  const response = await fetch(`${API_URL}?${params}`);
  return await response.json();
}

async function apiTambah(data, sheetName) {
  const params = new URLSearchParams({
    action: 'tambah',
    sheet: sheetName,
    data: JSON.stringify(data)
  });
  const response = await fetch(`${API_URL}?${params}`);
  return await response.json();
}

async function apiHapus(id, sheetName) {
  const params = new URLSearchParams({action: 'hapus', id: id, sheet: sheetName});
  await fetch(`${API_URL}?${params}`);
}

</script>

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style1.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>

    


      /* Gabungan Style Asli dan Modern */
      body {
        margin: 0;
        font-family: "Roboto", Arial, sans-serif;
        background: #f6f8fa;
        overflow-x: hidden;
      }
      .hamburger {
        position: fixed;
        top: 14px;
        left: 18px;
        background: #fff;
        color: #169d5c;
        border-radius: 7px;
        z-index: 1200;
        cursor: pointer;
        box-shadow: 0 0 6px #dde0e8;
        border: 1.5px solid #e3e3e9;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        user-select: none;
        transition: left 0.25s cubic-bezier(0.62, 0.01, 0.44, 1.19);
      }
      .hamburger.shifted {
        left: 240px;
      }
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: 240px;
        height: 100vh;
        background: #232f38;
        color: #fff;
        z-index: 1100;
        transition: transform 0.25s cubic-bezier(0.62, 0.01, 0.44, 1.19);
        box-shadow: 2px 0 7px rgba(60, 60, 70, 0.09);
      }
      .sidebar.closed {
        transform: translateX(-250px);
      }
      .sidebar .logo {
        font-size: 21px;
        font-weight: bold;
        padding: 20px 26px 11px 26px;
        letter-spacing: 0.65px;
        background: #169d5c;
      }
      .alamat-desa {
        padding: 12px 27px;
        font-size: 15px;
        color: #b1ffe3;
      }
      .sidebar .search {
        margin: 10px 18px 16px 18px;
        padding: 7px 13px;
        width: calc(100% - 40px);
        border-radius: 5px;
        border: none;
      }
      .menu {
        margin: 16px 0 0 0;
      }
      .menu-item {
        display: block;
        color: #e9f2f2;
        text-decoration: none;
        padding: 10px 0 10px 28px;
        margin-bottom: 7px;
        font-size: 15px;
        border-radius: 5px;
      }
      .menu-item.active,
      .menu-item:hover {
        background: #169d5c;
        color: #fff;
      }
      .sidebar .user {
        position: absolute;
        left: 27px;
        bottom: 14px;
      }
      .main-content {
        margin-left: 240px;
        min-height: 100vh;
        transition: margin-left 0.2s;
      }
      .sidebar.closed ~ .main-content {
        margin-left: 0;
      }

/* === DASHBOARD LAYOUT DASAR === */
main#dashboard{
  padding:24px 26px 40px;
}

/* Semua section dashboard */
#dashboard section{
  margin-bottom:28px;
}

/* Judul-judul utama di dashboard */
#dashboard h1{
  margin:8px 0 10px;
  font-size:2.3rem;
}
#dashboard h2{
  margin:0 0 6px;
  font-size:1.5rem;
}
#dashboard h3{
  margin:0 0 4px;
  font-size:1.05rem;
}

/* === HERO UTAMA === */
#heroDashboard{
  display:grid;
  grid-template-columns:minmax(0,1.3fr) minmax(0,1fr);
  gap:28px;
  align-items:center;
  padding:26px 26px 24px;
  border-radius:18px;
  background:linear-gradient(135deg,#169d5c,#18bad4);
  color:#fff;
  box-shadow:0 15px 35px rgba(0,0,0,0.12);
  position:relative;
  overflow:hidden;
}
#heroDashboard::before,
#heroDashboard::after{
  content:"";
  position:absolute;
  border-radius:50%;
  background:rgba(255,255,255,0.15);
}
#heroDashboard::before{
  width:260px;
  height:260px;
  right:-80px;
  top:-70px;
}
#heroDashboard::after{
  width:210px;
  height:210px;
  left:-90px;
  bottom:-90px;
}

#heroDashboard .hero-left{
  position:relative;
  z-index:1;
}
.hero-pill{
  display:inline-flex;
  align-items:center;
  padding:4px 12px;
  border-radius:999px;
  background:rgba(255,255,255,0.18);
  font-size:11px;
  letter-spacing:0.08em;
  text-transform:uppercase;
}
#heroDashboard p{
  margin:0 0 14px;
  font-size:14.5px;
}

/* Tombol-hero memakai .btn bawaan, jadi cukup atur jarak */
.hero-actions{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom:16px;
}

.hero-stats{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
}
.hero-stats .stat-item{
  min-width:90px;
  padding:8px 10px;
  border-radius:11px;
  background:rgba(255,255,255,0.18);
}
.hero-stats .stat-item span{
  display:block;
  font-size:19px;
  font-weight:700;
}
.hero-stats .stat-item label{
  display:block;
  font-size:11px;
  letter-spacing:0.09em;
  text-transform:uppercase;
}

/* Logo hero */
#heroDashboard .hero-right{
  position:relative;
  z-index:1;
  display:flex;
  justify-content:center;
}
.hero-logo-box{
  background:#fdfdfd;
  border-radius:18px;
  padding:14px 14px 10px;
  box-shadow:0 18px 40px rgba(0,0,0,0.25);
  text-align:center;
  max-width:250px;
  animation:heroFloat 3s ease-in-out infinite;
}
.hero-logo-box img{
  width:100%;
  height:auto;
  display:block;
}
.hero-logo-caption{
  margin-top:6px;
  font-size:12px;
  font-weight:500;
  color:#166b4b;
}

/* === PROFIL DUSUN === */
#profilDusun header p,
#potensiProgram header p,
#kegiatanRutin header p,
#catatanWargaSection header p{
  margin:0;
  font-size:13px;
  color:#5b6b66;
}

/* Grid 4 kolom responsif */
.info-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}
.info-card{
  border-radius:13px;
  padding:14px 14px 12px;
  color:#fff;
  box-shadow:0 10px 22px rgba(0,0,0,0.12);
  font-size:14px;
}
#profilSejarah{background:linear-gradient(135deg,#19a96b,#24c680);}
#profilGeografi{background:linear-gradient(135deg,#1f95c8,#2ebde4);}
#profilPenduduk{background:linear-gradient(135deg,#f39c12,#f6b63f);}
#profilInfrastruktur{background:linear-gradient(135deg,#8e44ad,#a55eea);}

/* === POTENSI & PROGRAM === */
.potensi-grid{
  margin-top:14px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}
.potensi-card{
  background:#ffffff;
  border-radius:13px;
  padding:14px 15px 12px;
  box-shadow:0 8px 18px rgba(0,0,0,0.06);
  border-top:4px solid #169d5c;
  font-size:14px;
}

/* === KEGIATAN (TIMELINE SEDERHANA) === */
.timeline{
  margin-top:12px;
  border-left:3px solid #18bad4;
  padding-left:14px;
}
.timeline-item{
  margin-bottom:12px;
  padding-bottom:6px;
  position:relative;
}
.timeline-item::before{
  content:"";
  position:absolute;
  left:-9px;
  top:2px;
  width:12px;
  height:12px;
  border-radius:50%;
  background:#18bad4;
  box-shadow:0 0 0 5px rgba(24,186,212,0.2);
}

/* === KONTAK === */
#kontakDusun{
  display:grid;
  grid-template-columns:minmax(0,1.3fr) minmax(0,1fr);
  gap:18px;
  align-items:flex-start;
  padding:18px 18px 16px;
  border-radius:15px;
  background:linear-gradient(135deg,#e7fff5,#e3f4ff);
}
#kontakDusun .kontak-left ul{
  padding-left:18px;
  margin:6px 0 10px;
  font-size:14px;
}
#kontakDusun .kontak-right{
  background:#ffffff;
  border-radius:12px;
  padding:12px 14px;
  box-shadow:0 8px 18px rgba(0,0,0,0.06);
  font-size:14px;
}

/* === CATATAN WARGA === */
#catatanWargaSection .catatan-wrapper{
  margin-top:12px;
  display:grid;
  grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
  gap:18px;
  align-items:flex-start;
}

/* Form catatan */
/* #catatanForm{
  background:#ffffff;
  border-radius:14px;
  padding:14px 16px;
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
}
#catatanForm .catatan-row{
  display:flex;
  gap:8px;
  margin-bottom:8px;
}
#catatanForm input,
#catatanForm textarea{
  width:100%;
  padding:7px 9px;
  border-radius:8px;
  border:1px solid #cfe3da;
  font-size:14px;
  box-sizing:border-box;
}
#catatanForm textarea{
  resize:vertical;
  margin-bottom:8px;
}
#catatanForm button{
  margin-top:4px;
}

/* List catatan */
/* #catatanList{
  max-height:260px;
  overflow-y:auto;
  background:linear-gradient(180deg,#f4fff8,#e9f5ff);
  border-radius:14px;
  padding:10px 12px;
  box-shadow:0 8px 18px rgba(0,0,0,0.05);
} */ 
.catatan-item{
  background:#ffffff;
  border-radius:10px;
  padding:7px 9px;
  margin-bottom:8px;
  font-size:13.5px;
  color:#394744;
}
.catatan-item-header{
  display:flex;
  justify-content:space-between;
  gap:6px;
  margin-bottom:2px;
  font-size:12px;
  color:#1b7452;
}
.catatan-item-tanggal{
  font-size:12px;
  color:#7a8883;
  margin-bottom:2px;
}
.catatan-empty{
  font-size:13px;
  color:#6e7a75;
  font-style:italic;
}

/* MINI BERITA & ARTIKEL DI BERANDA */
.mini-berita-wrapper{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));  /* SELALU 2 KOLOM */
  gap:14px 18px;
  margin-top:10px;
}

.mini-berita-item img,
.mini-berita-item embed{
  width:100%;           /* lebar tetap memenuhi kartu seperti tadi */
  height:310px;         /* PERBESAR tinggi supaya gambar lebih panjang */
  object-fit:cover;
  border-radius:8px;
  margin-bottom:6px;
}



.mini-berita-item{
  min-height:170px;       /* paksa kartu sedikit lebih tinggi */
  padding:10px 12px 11px;
}

.mini-berita-item iframe {
  width: 100%;
  height: 310px;
  border-radius: 8px;
  margin-bottom: 6px;
  border: none;
}

.mini-berita-item img,
.mini-berita-item embed {
  width: 100%;
  height: 310px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 6px;
}


.mini-berita-title{
  font-weight:600;
  font-size:14px;
  color:#166b4b;
  margin-bottom:2px;
}

.mini-berita-meta{
  font-size:16px;
  color:#7b8b86;
  margin-bottom:3px;
}

.mini-berita-text{
  font-size:18px;
  color:#35433f;
}

@media(max-width:700px){
  .mini-berita-wrapper{
    grid-template-columns:1fr;
  }
}



@media(max-width:700px){
  .mini-berita-wrapper{
    grid-template-columns:1fr;
  }
}


/* === ANIMASI HALUS === */
main#dashboard{
  opacity:0;
  transform:translateY(10px);
  animation:dashFadeIn .5s ease-out forwards;
}
@keyframes dashFadeIn{
  to{opacity:1;transform:translateY(0);}
}
@keyframes heroFloat{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-6px);}
}

/* RESPONSIVE */
@media (max-width:900px){
  #heroDashboard{
    grid-template-columns:1fr;
    padding:20px 16px 18px;
  }
  main#dashboard{
    padding:18px 14px 30px;
  }
  #kontakDusun{
    grid-template-columns:1fr;
  }
  #catatanWargaSection .catatan-wrapper{
    grid-template-columns:1fr;
  }
}


      nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 32px 9px 32px;
        background: #fff;
        border-bottom: 1px solid #e0e0e0;
      }
      .breadcrumb {
        font-size: 13px;
        color: #6f7f8c;
      }
      .user-panel i {
        margin-left: 16px;
      }
      .user-panel .username {
        margin-left: 8px;
      }
      h2 {
        margin-top: 18px;
      }
      
      .card {
        border-radius: 12px;
        background: #eee;
        padding: 23px 17px;
        min-height: 110px;
        box-shadow: 0 0 6px #f3f3f3;
      }
      .card-purple {
        background: #7266d6;
        color: #fff;
      }
      .card-blue {
        background: #08b3d0;
        color: #fff;
      }
      .card-green {
        background: #25b679;
        color: #fff;
      }
      .card-navy {
        background: #294362;
        color: #fff;
      }
      .card-red {
        background: #e74c3c;
        color: #fff;
      }
      .card-grey {
        background: #d4d5da;
        color: #222;
      }
      .card-orange {
        background: #f8ac43;
        color: #333;
      }
      .card-cyan {
        background: #55debc;
        color: #112228;
      }
      .card-value {
        font-size: 37px;
        font-weight: bold;
      }
      .btn,
      button {
        margin-top: 4px;
        padding: 7px 13px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background: #fff;
        color: #222;
        font-weight: bold;
      }
      .btn:hover,
      button:hover {
        background: #4e6efc;
      }
      .btn-danger {
        background: #e74c3c;
        color: #fff;
      }
      .admin-section {
        background: #fff;
        padding: 20px 20px 25px 20px;
        border-radius: 8px;
      }
      .admin-table {
        width: 100%;
        border-collapse: collapse;
      }
      .admin-table th,
      .admin-table td {
        border: 1px solid #ddd;
        padding: 7px;
        text-align: center;
      }
      .admin-table thead {
        background: #f2f2f2;
      }
      .admin-table tfoot {
        background: #e9ecef;
      }
      #form-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.4);
        align-items: center;
        justify-content: center;
        z-index: 99;
        display: none;
      }
      #admin-form {
        background: #fff;
        padding: 18px;
        border-radius: 6px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-width: 320px;
      }
      footer {
        margin-top: 32px;
        padding: 22px 7px;
        background: #f2f2f2;
        color: #333;
        text-align: center;
        border-radius: 6px;
      }
      .version {
        background: #d0f2cf;
        padding: 2px 8px;
        margin-left: 18px;
        border-radius: 5px;
      }

      /* Tambahan Surat Dinas */
      .tabel-pengaturan {
        background: #f7f8fa;
        padding: 10px 9px 13px 9px;
        border-radius: 6px;
      }
      .modal-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.11);
        z-index: 9999;
      }
      .modal-card {
        background: #fff;
        padding: 25px;
        max-width: 430px;
        width: 90vw;
        border-radius: 8px;
      }
      .surat-wrap {
        max-width: 700px;
        margin: 12px auto;
        background: #fff;
        padding: 15px 20px 22px 20px;
        border-radius: 7px;
      }
      .preview {
        background: #fff;
        padding: 12px 18px 13px 18px;
        margin-top: 13px;
        border: 1px solid #e4ebe6;
        min-height: 200px;
      }
      .btn-green {
        background: #30b95c;
        color: #fff;
      }
      .btn-blue {
        background: #267bac;
        color: #fff;
      }
      .btn-danger {
        background: #e74c3c;
        color: #fff;
      }
      .btn-yellow {
        background: #ffac3f;
        color: #333;
      }
      .btn-print {
        background: #19b5fe;
        color: #fff;
      }
      .btn-edit {
        background: #aaa;
        color: #fff;
      }

      /* Hover */
      .btn-green:hover {
        background: #199547;
      }
      .btn-blue:hover {
        background: #1d5c85;
      }
      .btn-danger:hover {
        background: #b93c31;
      }
      .btn-yellow:hover {
        background: #f6a01a;
      }
      .btn-print:hover {
        background: #0e7fcf;
      }
      .btn-edit:hover {
        background: #868686;
      }

      .kop-title {
        font-size: 18px;
        font-weight: bold;
        line-height: 1.5;
        text-align: center;
      }
      .kop-small {
        font-size: 14px;
        text-align: center;
      }
      .kop-line {
        border-top: 2.5px solid #333;
        border-bottom: 1px solid #333;
        margin: 7px 0 9px 0;
      }
      .judul-surat {
        text-align: center;
        text-decoration: underline;
        font-weight: bold;
        font-size: 17px;
        margin: 10px 0 2px 0;
      }
      .nomor-surat {
        text-align: center;
        margin-bottom: 9px;
        margin-top: 3px;
      }
      .field-table td {
        padding: 1.2px 8px 1.1px 0;
        font-size: 15px;
      }
      .surat-footer {
        margin-top: 16px;
        display: flex;
        justify-content: space-between;
      }
      .surat-footer .ttd {
        text-align: center;
      }
      .isian-form label {
        display: inline-block;
        width: 135px;
        font-size: 15px;
      }
      .isian-form input,
      .isian-form textarea {
        margin-bottom: 6px;
        padding: 4px 8px;
        width: 318px;
        max-width: 99%;
        border: 1px solid #aac1da;
        border-radius: 5px;
      }
      .isian-form textarea {
        width: 96%;
      }

      .btn-yellow:hover {
        background: #e09b2f;
      }
      #halamanUtamaDesa li {
        margin-bottom: 11px;
      }
      /* Header landing */
      
      /* Slider */
      .slider-section {
        max-width: 890px;
        margin: 0 auto 49px;
        border-radius: 13px;
        box-shadow: 0 2px 17px #bcfcff44;
        position: relative;
        overflow: hidden;
        user-select: none;
      }
      .swiper {
        display: flex;
        transition: transform 0.7s cubic-bezier(0.89, 0.44, 0.11, 1.06);
        will-change: transform;
        height: 265px;
      }
      .swiper img {
        width: 100%;
        object-fit: cover;
        border-radius: 13px;
        height: 265px;
        pointer-events: none;
        user-select: none;
      }
      .slide-caption {
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        background: rgba(33, 66, 99, 0.21);
        color: white;
        font-size: 20px;
        padding: 14px 23px;
        border-radius: 0 0 13px 13px;
        text-shadow: 0 1px 7px rgb(27 27 27 / 50%);
        user-select: none;
      }
      .slide-arrows {
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: space-between;
        transform: translateY(-50%);
        z-index: 3;
        pointer-events: none;
      }
      .slide-arrow {
        pointer-events: auto;
        background: rgba(15, 52, 65, 0.66);
        border: 0;
        color: white;
        font-size: 28px;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        cursor: pointer;
        user-select: none;
        line-height: 28px;
        font-weight: 600;
        transition: background 0.3s ease;
      }
      .slide-arrow:hover {
        background: #008662;
      }
      /* Berita and Artikel Masonry Grid */
      .berita-title {
        margin: 0 auto 25px auto;
        font-size: 1.7rem;
        color: #177255;
        font-weight: 700;
        user-select: none;
      }
      .masonry-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(315px, 1fr));
        gap: 25px;
      }
      .news-card,
      .article-card {
        background: white;
        border-radius: 11px;
        box-shadow: 0 0 12px #dceeee53;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: box-shadow 0.25s ease, border-color 0.25s ease;
        border: 2px solid #f0f7f9;
        user-select: none;
      }
      .news-card:hover,
      .article-card:hover {
        box-shadow: 0 4px 20px #14cbb446;
        border-color: #9cf2f1;
      }
      .news-card img,
      .article-card img {
        width: 100%;
        max-height: 190px;
        object-fit: cover;
        pointer-events: none;
        user-select: none;
      }
      .news-content {
        padding: 18px 18px 10px 18px;
        flex-grow: 1;
      }
      .news-meta {
        color: #0b8778;
        font-size: 13px;
        user-select: none;
      }
      .news-headline {
        font-size: 1.15rem;
        font-weight: 700;
        color: #232f38;
        text-decoration: none;
        cursor: pointer;
      }
      .news-headline:hover {
        text-decoration: underline;
        color: #169d5c;
      }
      .news-body {
        margin-top: 6px;
        font-size: 15px;
        color: #333;
      }
      /* Admin Berita */
      .admin-berita-section {
        max-width: 868px;
        margin: 60px auto 36px;
        background: #f2f8f8;
        border-radius: 11px;
        box-shadow: 0 1px 17px #d4ecee6a;
        padding: 23px 27px;
        user-select: none;
      }
      .admin-berita-section button {
        margin-bottom: 20px;
        font-size: 15px;
        padding: 7px 17px;
        border-radius: 7px;
        background: #22936f;
        color: white;
        border: none;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      .admin-berita-section button:hover {
        background: #007344;
      }
      .adminListGrid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
        gap: 20px;
      }
      .admin-card {
        background: white;
        padding: 16px 13px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 1px 8px #d4ecee48;
        position: relative;
        user-select: none;
      }
      .admin-card img {
        width: 100%;
        max-height: 100px;
        border-radius: 7px;
        object-fit: cover;
        user-select: none;
      }
      .admin-card .btn-group {
        margin-top: 13px;
      }
      .admin-card button {
        font-size: 13px;
        margin-right: 11px;
        padding: 5px 12px;
        border-radius: 6px;
        border: 0;
        cursor: pointer;
      }
      .admin-card .edit-btn {
        background: #29ca9f;
        color: white;
      }
      .admin-card .edit-btn:hover {
        background: #139889;
      }
      .admin-card .delete-btn {
        background: #dd4b49;
        color: white;
      }
      .admin-card .delete-btn:hover {
        background: #b32b27;
      }
      /* Modal form */
      .modal-bg {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        justify-content: center;
        align-items: center;
        background: rgba(30, 58, 78, 0.13);
        z-index: 1099;
      }
      .modal-form {
        background: white;
        padding: 27px 24px 18px 24px;
        border-radius: 9px;
        min-width: 320px;
        box-shadow: 0 1px 17px #bcfcff44;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .modal-form label {
        font-size: 14px;
        color: #17897c;
        font-weight: 500;
      }
      .modal-form input,
      .modal-form textarea,
      .modal-form select {
        width: 100%;
        padding: 9px 8px;
        border-radius: 6px;
        border: 1.3px solid #cae8ea;
        font-size: 13.7px;
        resize: vertical;
      }
      .modal-form button {
        margin-top: 13px;
        padding: 10px 0;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        background: #169d5c;
        color: white;
        font-size: 17px;
        font-weight: 700;
        user-select: none;
      }
      .modal-form button[type="button"] {
        background: white;
        color: #22936f;
        border: 1px solid #ddd;
        margin-top: 0;
      }
      @media screen and (max-width: 900px) {
        .hamburger.shifted {
          left: 6px;
        }
        .sidebar {
          width: 85vw;
        }
        .sidebar.closed {
          transform: translateX(-100vw);
        }
        .main-content {
          margin-left: 0;
          padding: 15px 10px;
        }
        .masonry-grid {
          grid-template-columns: 1fr !important;
        }
        
      }
      /* peta */
      .peta-section {
        max-width: 900px;
        margin: 46px auto 24px auto;
        background: white;
        padding: 24px 32px 29px 32px;
        border-radius: 13px;
        box-shadow: 0 2px 22px #11cab636;
        user-select: none;
      }
      #mapDesa {
        width: 100%;
        height: 350px;
        border-radius: 11px;
        margin-top: 17px;
      }

      /* LAYOUT DASHBOARD BARU */
      

      /* HERO */
      .hero {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
        gap: 32px;
        align-items: center;
        margin-bottom: 32px;
        background: radial-gradient(circle at top left, #e9fff7, #f6f8fa);
        border-radius: 18px;
        padding: 28px 26px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.04);
      }
      .hero-left h1 {
        font-size: 2.4rem;
        margin: 10px 0 8px;
        color: #12302a;
      }
      .hero-left p {
        margin: 0 0 16px;
        color: #435a52;
        font-size: 15px;
      }
      .hero-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(22, 157, 92, 0.08);
        color: #16875e;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.07em;
      }
      .hero-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 18px;
      }
      .btn-primary {
        background: #169d5c;
        color: #fff;
      }
      .btn-primary:hover {
        background: #0f7f4a;
      }
      .btn-outline {
        background: transparent;
        border: 1px solid #d2e9dd;
        color: #166a4a;
      }
      .btn-outline:hover {
        background: #e7fbf1;
      }
      .hero-stats {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
      }
      .stat-item {
        min-width: 110px;
        padding: 10px 12px;
        border-radius: 12px;
        background: #fff;
        box-shadow: 0 2px 10px rgba(15, 91, 66, 0.05);
      }
      .stat-item span {
        display: block;
        font-size: 22px;
        font-weight: 700;
        color: #158354;
      }
      .stat-item label {
        display: block;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #688274;
      }

      /* HERO RIGHT */
      .hero-right {
        display: flex;
        justify-content: center;
      }
      .hero-image-wrapper {
        position: relative;
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 14px 35px rgba(0, 0, 0, 0.18);
      }
      .hero-image-wrapper img {
        display: block;
        width: 100%;
        max-height: 260px;
        object-fit: cover;
      }
      .hero-badge {
        position: absolute;
        left: 14px;
        bottom: 14px;
        background: rgba(7, 41, 32, 0.86);
        color: #f4fff9;
        padding: 8px 13px;
        border-radius: 999px;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      /* Header kecil */
.blok-header {
  text-align: left;
  margin-bottom: 12px;
}

.blok-header h2 {
  margin: 4px 0 4px;
  font-size: 1.6rem;
  color: #184931;
}

.blok-header p {
  margin: 0;
  font-size: 14px;
  color: #57645f;
}

.tag-mini {
  display: inline-block;
  padding: 3px 9px;
  border-radius: 999px;
  background: rgba(22,157,92,0.08);
  color: #16875e;
  font-size: 11px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

/* Layout filosofi logo */
#filosofiLogoSection {
  margin-top: 28px;
  padding: 20px 22px 22px;
  border-radius: 18px;
  background: radial-gradient(circle at top left, #fff7ec, #fffdf8);
  box-shadow: 0 10px 24px rgba(0,0,0,0.04);
}

.filosofi-layout {
  margin-top: 10px;
  display: grid;
  grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.5fr);
  gap: 22px;
  align-items: flex-start;
}

.filosofi-logo-card {
  background: #ffffff;
  border-radius: 16px;
  padding: 14px 14px 10px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}

.filosofi-logo-card img {
  width: 100%;
  display: block;
  border-radius: 12px;
  margin-bottom: 10px;
}

.logo-tagline {
  list-style: none;
  padding: 0;
  margin: 0;
  font-size: 13px;
  color: #42534d;
}

.logo-tagline li {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.logo-tagline i {
  width: 20px;
  text-align: center;
  color: #169d5c;
}

/* Elemen teks kanan */
.filosofi-right {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.filosofi-row {
  display: grid;
  grid-template-columns: minmax(0,1fr) minmax(0,1fr);
  gap: 10px;
}

.filosofi-item {
  background: #ffffff;
  border-radius: 12px;
  padding: 10px 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.03);
  font-size: 13.5px;
  color: #495752;
}

.filosofi-item h3 {
  margin: 0 0 4px;
  font-size: 14px;
  color: #8d4b1f;
  display: flex;
  align-items: center;
  gap: 6px;
}

.filosofi-item h3 span {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  border-radius: 999px;
  background: #ffe5c2;
  color: #8d4b1f;
  font-size: 11px;
  font-weight: 700;
}

/* Sejarah timeline */
#sejarahDusunSection {
  margin-top: 22px;
  padding: 18px 22px 22px;
  border-radius: 18px;
  background: #f5fbf8;
  box-shadow: 0 8px 20px rgba(0,0,0,0.04);
}

.timeline-sejarah {
  margin-top: 8px;
  border-left: 3px solid #18bad4;
  padding-left: 14px;
}

.timeline-item {
  position: relative;
  margin-bottom: 12px;
  padding-bottom: 6px;
}

.timeline-dot {
  position: absolute;
  left: -19px;
  top: 4px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #18bad4;
  box-shadow: 0 0 0 5px rgba(24,186,212,0.25);
}

.timeline-body h3 {
  margin: 0 0 3px;
  font-size: 14px;
  color: #156b92;
}

.timeline-body p {
  margin: 0;
  font-size: 13.5px;
  color: #435450;
  text-align: justify;
}

/* Responsif */
@media (max-width: 900px) {
  .filosofi-layout { grid-template-columns: 1fr; }
  .filosofi-row { grid-template-columns: 1fr; }
}


      #catatanWargaSection .catatan-wrapper{
  margin-top:12px;
  display:grid;
  grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
  gap:18px;
  align-items:flex-start;
}
#catatanForm{
  background:#ffffff;
  border-radius:14px;
  padding:14px 16px;
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
}
#catatanForm .catatan-row{
  display:flex;
  gap:8px;
  margin-bottom:8px;
}
#catatanForm input,
#catatanForm textarea{
  width:100%;
  padding:7px 9px;
  border-radius:8px;
  border:1px solid #cfe3da;
  font-size:14px;
  box-sizing:border-box;
}
#catatanForm textarea{
  resize:vertical;
  margin-bottom:8px;
}
#catatanForm button{
  margin-top:4px;
}

#catatanList{
  max-height:260px;
  overflow-y:auto;
  background:linear-gradient(180deg,#f4fff8,#e9f5ff);
  border-radius:14px;
  padding:10px 12px;
  box-shadow:0 8px 18px rgba(0,0,0,0.05);
}
.catatan-item{
  background:#ffffff;
  border-radius:10px;
  padding:7px 9px;
  margin-bottom:8px;
  font-size:13.5px;
  color:#394744;
}
.catatan-item-header{
  display:flex;
  justify-content:space-between;
  gap:6px;
  margin-bottom:2px;
  font-size:12px;
  color:#1b7452;
}
.catatan-item-tanggal{
  font-size:12px;
  color:#7a8883;
  margin-bottom:2px;
}
.catatan-empty{
  font-size:13px;
  color:#6e7a75;
  font-style:italic;
}
.catatan-item button{
  font-size:11px;
  padding:2px 7px;
  border-radius:6px;
  border:none;
  background:#e74c3c;
  color:#fff;
  cursor:pointer;
}
@media(max-width:900px){
  #catatanWargaSection .catatan-wrapper{
    grid-template-columns:1fr;
  }
}

      
      /* PERBAIKI GRID BERITA/KEUNGGULAN AGAR MASUK DESAIN BARU */
      .masonry-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 18px;
      }
      .news-card,
      .article-card {
        border-radius: 12px;
      }
      .news-content {
        padding: 14px 15px 12px;
      }
      .news-meta {
        font-size: 11px;
      }
      .news-headline {
        font-size: 1rem;
      }

      #pageLoader {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.82);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1300;
        backdrop-filter: blur(2px);
      }

      .loader-circle{
  width:90px;      /* dari 70px */
  height:90px;
  border-radius:50%;
  border:3px solid rgba(255,255,255,0.7);
  box-shadow:0 0 0 0 rgba(22,157,92,0.4);
  animation:pulseRing 1.8s ease-out infinite;
  margin:0 auto 14px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.loader-logo{
  width:150px;      /* dari 46px */
  height:150px;
  border-radius:14px;
  overflow:hidden;
  background:#ffffff;
  box-shadow:0 6px 16px rgba(0,0,0,0.12);
  animation:logoFloat 2.2s ease-in-out infinite;
}

.loader-logo img{
  width:100%;
  height:100%;
  object-fit:contain;
}


/* --- MODAL TEMPLATE SURAT DINAS COMPACT --- */
.modal-card {
  background: #fff;
  border-radius: 13px;
  max-width: 400px;
  margin: auto;
  padding: 22px 16px 18px 16px;
  box-shadow: 0 3px 16px #bde6d94c;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.modal-card h2,
.modal-card h3 {
  text-align: left;
  margin-bottom: 3px;
  font-size: 1.07rem;
  color: #189d63;
  font-weight: 700;
  letter-spacing: 0.1px;
  padding-left: 1px;
}

.modal-card form {
  display: flex;
  flex-direction: column;
  gap: 8px;
  overflow-y: auto;        /* â— scroll di dalam modal */
  padding-right: 4px;      /* ruang untuk scroll bar */
}

/* header & tombol di atas tetap */
.modal-card h4 {
  position: sticky;
  top: 0;
  background: #fff;
  padding-top: 1px;
  padding-bottom: 3px;
  z-index: 1;
}

.modal-card label {
  font-size: 0.98rem;
  font-weight: 600;
  color: #299971;
  margin-bottom: 3px;
  margin-top: 0;
  display: block;
}

.modal-card input,
.modal-card textarea {
  width: 100%;
  font-size: 0.97rem;
  padding: 7px 9px;
  border-radius: 7px;
  border: 1.2px solid #d8f3e3;
  background: #f9fefa;
  margin-bottom: 1px;
  outline: none;
  box-sizing: border-box;
  transition: border-color 0.2s, background 0.2s;
}

.modal-card input:focus,
.modal-card textarea:focus {
  border-color: #169d5c;
  background: #eefaf1;
}

.modal-card textarea {
  resize: vertical;
  min-height: 35px;
  font-family: inherit;
}

.modal-card .modal-group {
  display: flex;
  gap: 6px;
  margin-bottom: 0;
}

.modal-card .modal-group > div {
  flex: 1 1 0;
}

.modal-card .modal-actions {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  margin-top: 10px;
}

.modal-card .btn {
  font-weight: 600;
  background: #e6f8f2;
  color: #169d5c;
  padding: 7px 18px;
  border-radius: 7px;
  border: none;
  cursor: pointer;
  box-shadow: 0 1px 4px #c6e6d870;
  font-size: 0.97rem;
  transition: background 0.2s, color 0.2s;
}

.modal-card .btn-green {
  background: #169d5c;
  color: #fff;
}
.modal-card .btn-green:hover {
  background: #157e51;
}
.modal-card .btn:hover:not(.btn-green) {
  background: #e0f0ea;
  color: #16755f;
}
/* --- PRINT ONLY PREVIEW SURAT --- */
@media print {
  body * {
    visibility: hidden !important;
  }
  #previewCetakSurat,
  #previewCetakSurat * {
    visibility: visible !important;
  }
  #previewCetakSurat {
    position: absolute !important;
    left: 0;
    top: 0;
    right: 0;
    box-shadow: none !important;
    margin: 0 !important;
    width: 100% !important;
    padding: 0 !important;
    background: #fff !important;
    min-height: 100vh !important;
  }
}

/* KEUNGGULAN    */

.modal-bg {
  position: fixed;
  z-index: 9999;
  inset: 0;
  display: none;
  background: rgba(15, 45, 18, 0.15);
  align-items: center;
  justify-content: center;
}
.galeri-modal-card {
  background: #fff;
  padding: 14px 17px 20px;
  border-radius: 13px;
  box-shadow: 0 8px 30px #1e94476b;
  max-width: 400px;
  min-width: 210px;
  text-align: center;
}
.galeri-caption {
  font-size: 1rem;
  color: #188d5e;
  margin-top: 15px;
}
.unggulan-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 23px 30px;
  max-width: 1040px;
  margin: 0 auto 29px auto;
}
.unggulan-card {
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 2px 14px #b9e1b033;
  text-align: center;
  overflow: hidden;
  padding: 0 0 16px 0;
  transition: box-shadow 0.19s, transform 0.16s;
}
.unggulan-card:hover {
  box-shadow: 0 8px 30px #23aa662c;
  transform: translateY(-4px) scale(1.012);
}
.unggulan-card img {
  width: 100%;
  max-height: 140px;
  object-fit: cover;
  background: #e4e4e4;
}
.unggulan-card h3 {
  color: #188840;
  font-size: 1.09rem;
  margin: 13px 0 5px 0;
}
.unggulan-card p {
  color: #464646;
  margin: 0 14px;
  font-size: 0.96rem;
}

/* BERITA       */
.berita-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(310px, 1fr));
  gap: 23px 30px;
  max-width: 1140px;
  margin: 0 auto 30px auto;
  align-items: stretch;
}
.berita-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 18px #cdecd344;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: box-shadow 0.22s, transform 0.19s;
  min-height: 320px;
  position: relative;
  border: 1px solid #e6f7ea;
}
.berita-card:hover {
  box-shadow: 0 8px 32px #18d29825;
  transform: translateY(-7px) scale(1.03);
}
.berita-img {
  width: 100%;
  height: 148px;
  object-fit: cover;
  background: #eafaf2;
}
.berita-body {
  flex: 1;
  padding: 18px 20px 15px 20px;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}
.berita-title {
  color: #16875e;
  font-size: 1.12rem;
  font-weight: bold;
  margin: 0 0 9px 0;
  line-height: 1.19;
}
.berita-meta {
  font-size: 0.91rem;
  color: #899;
  margin-bottom: 7px;
  font-style: italic;
}
.berita-desc {
  color: #2c3633;
  font-size: 0.98rem;
  margin-bottom: 9px;
  flex: 1;
}
.berita-link {
  color: #12a079;
  background: #edfff8;
  font-weight: 700;
  padding: 7px 19px;
  border-radius: 24px;
  font-size: 0.96rem;
  text-decoration: none;
  transition: background 0.18s;
}
.berita-link:hover {
  background: #b6f8da;
}
@media (max-width: 700px) {
  .unggulan-grid,
  .berita-grid {
    grid-template-columns: 1fr;
  }
  .berita-card,
  .unggulan-card {
    min-height: auto;
  }
}

#cuacaTanamSection {
  margin-top: 28px;
  padding: 18px 22px 22px;
  border-radius: 18px;
  background: radial-gradient(circle at top left, #e9f7ff, #f9fdff);
  box-shadow: 0 10px 24px rgba(0,0,0,0.04);
}

.cuaca-tanam-wrap {
  margin-top: 10px;
  display: grid;
  grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.1fr);
  gap: 18px;
  align-items: stretch;
}

/* Notifikasi perubahan cuaca */
.ct-notif {
  margin-bottom: 10px;
  padding: 8px 11px;
  border-radius: 10px;
  background: #fff9e6;
  color: #7a4d00;
  font-size: 13px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}


.cuaca-card,
.tanam-card {
  background: #ffffff;
  border-radius: 14px;
  padding: 14px 16px;
  box-shadow: 0 5px 14px rgba(0,0,0,0.03);
  font-size: 13.5px;
  color: #2f4248;
}

.cuaca-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.cuaca-top h3,
.tanam-card h3 {
  margin: 0 0 4px;
  font-size: 15px;
  color: #156b92;
}

.ct-tanggal {
  font-size: 12px;
  color: #6d7a80;
}

.ct-badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  background: rgba(24,186,212,0.14);
  color: #0c6f8e;
}

.cuaca-middle {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  margin-top: 8px;
}

.ct-suhu-blok {
  display: flex;
  flex-direction: column;
}

.ct-suhu {
  font-size: 26px;
  font-weight: 700;
  color: #0b82c0;
}

.ct-kondisi {
  font-size: 13px;
  color: #32444a;
}

.ct-detail {
  display: flex;
  flex-direction: column;
  gap: 2px;
  font-size: 12.5px;
  color: #4e5d62;
  text-align: right;
}

.cuaca-footer small {
  font-size: 11px;
  color: #7b878d;
}

.tanam-ringkasan {
  margin: 2px 0 8px;
  font-size: 13px;
  color: #37453a;
}

.tanam-ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

.tanam-ul li {
  margin-bottom: 4px;
  font-size: 13px;
}

@media (max-width: 900px) {
  .cuaca-tanam-wrap {
    grid-template-columns: 1fr;
  }
}


/* ARTIKEL   */
.artikel-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 22px 30px;
  max-width: 1120px;
  margin: 0 auto 28px auto;
}
.artikel-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 14px #d5ebec44;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: box-shadow 0.19s, transform 0.17s;
  min-height: 260px;
  border: 1px solid #eef7f8;
}
.artikel-card:hover {
  box-shadow: 0 7px 32px #13cc9321;
  transform: translateY(-5px) scale(1.018);
}
.artikel-img {
  width: 100%;
  height: 128px;
  object-fit: cover;
  background: #e6efea;
}
.artikel-body {
  flex: 1;
  padding: 17px 18px 12px 18px;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}
.artikel-title {
  color: #1c8e65;
  font-size: 1.08rem;
  font-weight: bold;
  margin: 0 0 8px 0;
  line-height: 1.17;
}
.artikel-meta {
  font-size: 0.91rem;
  color: #9a9;
  margin-bottom: 7px;
  font-style: italic;
}
.artikel-desc {
  color: #2b3534;
  font-size: 0.99rem;
  margin-bottom: 9px;
  flex: 1;
}
.artikel-link {
  color: #159a7a;
  background: #f4fffc;
  font-weight: 700;
  padding: 7px 18px;
  border-radius: 20px;
  font-size: 0.95rem;
  text-decoration: none;
  transition: background 0.16s;
}
.artikel-link:hover {
  background: #c8fdea;
}
@media (max-width: 700px) {
  .artikel-grid {
    grid-template-columns: 1fr;
  }
  .artikel-card {
    min-height: auto;
  }
}
.news-grid,
.article-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(330px, 1fr));
  gap: 24px 32px;
  max-width: 1060px;
  margin: 0 auto 30px auto;
}
.news-card,
.article-card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 14px #dadada44;
  overflow: hidden;
  transition: box-shadow 0.18s, transform 0.16s;
  min-height: 230px;
  display: flex;
  flex-direction: column;
}
.news-card:hover,
.article-card:hover {
  box-shadow: 0 6px 30px #0ec06315;
  transform: translateY(-6px) scale(1.015);
}
.news-card img,
.article-card img {
  width: 100%;
  height: 143px;
  object-fit: cover;
}
.news-content,
.article-body {
  padding: 18px;
  flex: 1;
  display: flex;
  flex-direction: column;
}
.news-title,
.article-title {
  font-weight: bold;
  font-size: 1.17rem;
  color: #188840;
  margin-bottom: 5px;
}
.news-meta,
.article-meta {
  color: #979;
  font-size: 0.92rem;
  margin-bottom: 5px;
  font-style: italic;
}
.news-desc,
.article-desc {
  color: #414141;
  font-size: 0.99rem;
  margin-bottom: 7px;
  flex: 1;
}
form#formBerita input,
form#formBerita textarea,
form#formBerita select {
  margin-bottom: 7px;
  padding: 6px;
  border-radius: 5px;
  border: 1px solid #bbb;
}
form#formBerita button {
  background: #23a158;
  color: #fff;
  border-radius: 5px;
  border: 0;
  padding: 9px 20px;
  font-size: 1rem;
  cursor: pointer;
}
form#formBerita button:hover {
  background: #16875e;
}
@media (max-width: 700px) {
  .news-grid,
  .article-grid {
    grid-template-columns: 1fr;
  }
}
#daftarBeritaAdmin table {
  border-collapse: collapse;
  margin: 16px auto;
  width: 100%;
}
#daftarBeritaAdmin th,
#daftarBeritaAdmin td {
  padding: 8px 7px;
  border: 1px solid #ddd;
}
#daftarBeritaAdmin th {
  background: #d0f5e8;
}
#daftarBeritaAdmin td button {
  padding: 5px 16px;
  background: #ea4e2f;
  color: #fff;
  border: 0;
  border-radius: 4px;
}

.info-card img.profil-img {
  width: 100%;
  max-height: 150px;
  object-fit: cover;
  border-radius: 10px;
  margin-bottom: 8px;
}

.ai-plant-analyzer {
  margin-top: 12px;
  display: grid;
  grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
  gap: 18px;
  align-items: flex-start;
}

.ai-upload-form {
  background: #ffffff;
  border-radius: 14px;
  padding: 14px 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}

.upload-zone {
  border: 3px dashed #169d5c;
  border-radius: 12px;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  background: linear-gradient(135deg, #f8fff8, #e8f5e8);
}

.upload-zone:hover,
.upload-zone.dragover {
  border-color: #0f7f4a;
  background: linear-gradient(135deg, #e8f5e8, #d4f1d4);
  transform: scale(1.02);
}

.upload-zone i {
  font-size: 48px;
  color: #169d5c;
  margin-bottom: 15px;
}

.upload-zone p {
  margin: 0 0 5px 0;
  font-weight: 600;
  color: #166b4b;
}

.upload-zone span {
  font-size: 13px;
  color: #7a8883;
}

.ai-loading {
  display: none;
  text-align: center;
  padding: 30px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #e3f2e3;
  border-top: 4px solid #169d5c;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.ai-result {
  display: none;
  background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 8px 25px rgba(22,157,92,0.15);
}

.status-hidup { border-left: 5px solid #28a745; padding-left: 12px; }
.status-sakit { border-left: 5px solid #ffc107; padding-left: 12px; }
.status-mati  { border-left: 5px solid #dc3545; padding-left: 12px; }

.confidence-badge {
  background: rgba(22,157,92,0.2);
  color: #169d5c;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
}

@media (max-width: 900px) {
  .ai-plant-analyzer { grid-template-columns: 1fr; }
}



      .loader-spinner {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        border: 4px solid #d7f3e6;
        border-top-color: #169d5c;
        animation: spin 0.9s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* RESPONSIVE */
      @media (max-width: 900px) {
        .hero {
          grid-template-columns: 1fr;
          padding: 22px 18px;
        }
        main#dashboardPage {
          padding: 18px 14px 30px;
        }
      }

      /* Grid rapi untuk isian surat */
.form-grid-2col {
  display: grid;
  grid-template-columns: minmax(0,1.1fr) minmax(0,1.1fr);
  gap: 10px 18px;
  margin-bottom: 10px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.form-group label {
  font-size: 13px;
  font-weight: 600;
  color: #186b4a;
}

.form-group input,
.form-group textarea {
  font-size: 13.5px;
  padding: 7px 9px;
  border-radius: 6px;
  border: 1px solid #aac1da;
  width: 100%;
  box-sizing: border-box;
}

.form-full {
  grid-column: 1 / -1;
}

.form-actions {
  margin-top: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

/* Responsif: di HP jadi 1 kolom */
@media (max-width: 900px) {
  .form-grid-2col {
    grid-template-columns: 1fr;
  }
}

    </style>
  </head>
  <body>
    <div id="pageLoader">
  <div class="loader-inner">
    <div class="loader-circle"></div>
    <div class="loader-logo">
      <img src="Logo-Kajor-Kulon.png" alt="Logo Desa Kajor Kulon" />
    </div>
    <p class="loader-text">Memuat dashboard desa...</p>
  </div>
</div>


    <div class="hamburger" id="hamburgerBtn"><i class="fa fa-bars"></i></div>
    <div class="sidebar closed" id="sidebarNav">
      <div class="logo">Desa Kajor Kulon</div>
      <ul class="menu">
        <li>
          <a
            href="#"
            class="menu-item active"
            onclick="showSection('dashboard')"
          >
            <i class="fa fa-home"></i> Beranda
          </a>
        </li>
        <li>
          <a href="#" class="menu-item" onclick="showSection('kependudukan')">
            <i class="fa fa-users"></i> Kependudukan
          </a>
        </li>
        <li>
          <a href="#" class="menu-item" onclick="showSection('suratDinas')">
            <i class="fa fa-envelope"></i> Surat Dinas
          </a>
        </li>
        <li>
  <a href="#" class="menu-item" onclick="showSection('cuacaTanamSection')">
    <i class="fa fa-cloud-sun-rain"></i> Cuaca & Jadwal Tanam
  </a>
</li>
        <li>
          <a
            href="#"
            class="menu-item"
            onclick="showSection('layananSuratSection')"
          >
            <i class="fa fa-inbox"></i> Layanan Surat
          </a>
        </li>

        <li>
          <a
            href="#"
            class="menu-item"
            onclick="showSection('mapsdesaSection')"
          >
            <i class="fa fa-map-marked"></i> Peta Desa
          </a>
        </li>
        <li>
          <a
            href="#"
            class="menu-item"
            onclick="showSection('kelolaBeritaSection')"
          >
            <i class="fa fa-newspaper"></i> Kelola Berita/Artikel
          </a>
        </li>
      </ul>
    </div>
    <div class="main-content">
<main id="dashboard" class="main-section">
  <!-- HERO UTAMA -->
  <section id="heroDashboard">
    <div class="hero-left">
      <span class="hero-pill">Dukuh Kajor Kulon Kec. Imogiri</span>
      <h1>Beranda Desa Digital</h1>
      <p>
        Lihat sekilas sejarah, kondisi geografis, data penduduk, dan program
        unggulan Dusun Kajor Kulon dalam satu tampilan.
      </p>
      <div class="hero-actions">
        <button onclick="showSection('kependudukan')">
          <i class="fa fa-users"></i> Data Kependudukan
        </button>
        <button onclick="showSection('mapsdesaSection')">
          <i class="fa fa-map-marked"></i> Peta & Wilayah
        </button>
      </div>
      <div class="hero-stats">
        <div class="stat-item">
          <span>6</span>
          <label>RT</label>
        </div>
        <div class="stat-item">
          <span>Â±731</span>
          <label>Jiwa</label>
        </div>
      </div>
    </div>
    <div class="hero-right">
      <div class="hero-logo-box">
        <img src="Logo-Kajor-Kulon.png" alt="Logo Dusun Kajor Kulon" />
        <div class="hero-logo-caption">
          Tangguh Â· Hijau Â· Berdaya
        </div>
      </div>
    </div>
  </section>

  <section id="filosofiLogoSection">
  <header class="blok-header">
    <span class="tag-mini">Identitas Dusun</span>
    <h2>Filosofi Logo Kajor Kulon</h2>
    <p>Setiap garis dan warna di logo membawa cerita tentang alam, kerja keras, dan harapan warga Kajor Kulon.</p>
  </header>

  <div class="filosofi-layout">
    <!-- Kolom kiri: logo + highlight cepat -->
    <div class="filosofi-left">
      <div class="filosofi-logo-card">
        <img src="Logo-Kajor-Kulon.png" alt="Logo Dusun Kajor Kulon">
        <ul class="logo-tagline">
          <li><i class="fa fa-mountain"></i> Gunungan wayang: dunia & budaya</li>
          <li><i class="fa fa-leaf"></i> Padi & sawah: dusun agraris subur</li>
          <li><i class="fa fa-water"></i> Sungai: sumber air & kehidupan</li>
        </ul>
      </div>
    </div>

    <!-- Kolom kanan: elemen per elemen -->
    <div class="filosofi-right">
      <div class="filosofi-row">
        <div class="filosofi-item">
          <h3><span>01</span> Bentuk Gunungan Wayang</h3>
          <p>Bentuk kayon menggambarkan Kajor Kulon sebagai ekosistem utuh yang menaungi alam, budaya, dan warganya. Logo ini menegaskan peran dusun sebagai penjaga tradisi sekaligus ruang hidup bersama.</p>
        </div>
        <div class="filosofi-item">
          <h3><span>02</span> Puncak Tunas & Bintang</h3>
          <p>Tunas baru melambangkan awal yang baik, regenerasi, dan semangat tumbuh. Bintang di atasnya merepresentasikan nilai spiritual dan doa warga agar kehidupan dusun selalu mendapat tuntunan Illahi.</p>
        </div>
      </div>

      <div class="filosofi-row">
        <div class="filosofi-item">
          <h3><span>03</span> Daun, Lidah Api, Ukiran Jawa</h3>
          <p>Daun muda dan lidah api menjadi simbol energi warga yang tak padam. Motif ukiran Jawa di kiriâ€“kanan menandakan harmoni, gotong royong, dan kebanggaan terhadap seni tradisi lokal.</p>
        </div>
        <div class="filosofi-item">
          <h3><span>04</span> Sapi, Petani, Labu & Palawija</h3>
          <p>Sapi ternak, sosok petani, labu dan palawija mencerminkan karakter masyarakat agraris: pekerja keras, sederhana, dan mandiri secara ekonomi melalui hasil bumi yang beragam.</p>
        </div>
      </div>

      <div class="filosofi-row">
        <div class="filosofi-item">
          <h3><span>05</span> Sawah, Padi & Sungai</h3>
          <p>Hamparan sawah, malai padi, dan aliran sungai menegaskan bahwa tanah subur dan air yang mengalir adalah fondasi kesejahteraan keluarga-keluarga di Kajor Kulon hingga hari ini.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="sejarahDusunSection">
  <header class="blok-header">
    <span class="tag-mini">Jejak Waktu</span>
    <h2>Sejarah Singkat Dusun Kajor Kulon</h2>
  </header>

  <div class="timeline-sejarah">
    <div class="timeline-item">
      <div class="timeline-dot"></div>
      <div class="timeline-body">
        <h3>Akar Agraris di Perbukitan Imogiri</h3>
        <p>Kajor Kulon bermula sebagai permukiman kecil di lereng Imogiri, ketika keluarga-keluarga petani membuka lahan untuk sawah, ladang palawija, dan kebun campur. Sumber air dari sungai-sungai kecil menjadi penentu lokasi pemukiman.</p>
      </div>
    </div>

    <div class="timeline-item">
      <div class="timeline-dot"></div>
      <div class="timeline-body">
        <h3>Gotong Royong sebagai Nafas Dusun</h3>
        <p>Tradisi kerja bakti, ronda malam, dan kenduri kampung menumbuhkan rasa saling percaya. Nilai-nilai ini yang kemudian diwariskan lewat kegiatan karang taruna, kelompok tani, dan majelis taklim di tiap RT.</p>
      </div>
    </div>

    <div class="timeline-item">
      <div class="timeline-dot"></div>
      <div class="timeline-body">
        <h3>Bergerak ke Arah Desa Digital</h3>
        <p>Memasuki era digital, Kajor Kulon mulai memanfaatkan teknologi untuk administrasi, layanan surat, publikasi kegiatan, hingga inovasi seperti analisis kesehatan tanaman berbasis AI untuk mendukung petani setempat.</p>
      </div>
    </div>
  </div>
</section>
  
  <section id="ringkasanBeritaArtikel">
  <header>
    <h2>Berita & Artikel Terbaru</h2>
    <p>Update singkat kegiatan dan artikel penting di Dusun Kajor Kulon.</p>
  </header>

  <div class="ringkasan-grid">
    <div class="ringkasan-box">
      <h3>Berita Terbaru</h3>
      <div id="miniBeritaList" class="mini-berita-wrapper"></div>
    </div>
    <div class="ringkasan-box">
      <h3>Artikel Terbaru</h3>
      <div id="miniArtikelList" class="mini-berita-wrapper"></div>
    </div>
  </div>
</section>

<section id="analisisTumbuhanSection">
  <header>
    <h2>AI Analisis Kesehatan Tumbuhan</h2>
    <p>Upload foto tanaman, lalu sistem akan menganalisis kondisinya dan memberi saran perawatan.</p>
  </header>

  <div class="ai-plant-analyzer">
    <!-- Form upload -->
    <form id="aiPlantForm" class="ai-upload-form" enctype="multipart/form-data">
      <div class="upload-zone" id="uploadZone">
        <i class="fas fa-camera"></i>
        <p>Klik atau drag foto tanaman</p>
        <span>Format: JPG / PNG, maksimal 5MB</span>
        <input type="file" id="plantImage" accept="image/*" required style="display:none;">
      </div>
      <button type="submit" style="width:100%; margin-top:15px;">
        ðŸ” Analisis dengan AI
      </button>
    </form>

    <!-- Loading -->
    <div id="aiLoading" class="ai-loading">
      <div class="spinner"></div>
      <p>AI sedang menganalisis tanaman Anda...</p>
      <small>Mohon tunggu beberapa detik</small>
    </div>

    <!-- Hasil -->
    <div id="aiResult" class="ai-result">
      <div id="resultContent"></div>
      <button type="button" onclick="simpanKeRiwayatDesa()" 
              style="width:100%; margin-top:15px; background:#169d5c; color:white;">
        ðŸ’¾ Simpan ke Riwayat Desa
      </button>
    </div>
  </div>
</section>
  
  <!-- POTENSI & PROGRAM UNGGULAN -->
  <section id="potensiProgram">
    <header>
      <h2>Potensi & Program Unggulan</h2>
      <p>Aktivitas dan keunggulan yang menjadi kebanggaan dusun.</p>
    </header>
    <div class="potensi-grid">
      <article class="potensi-card">
        <h3>Pertanian Lahan Kering</h3>
        <p>
          Pengembangan padi, palawija, dan hortikultura dengan teknologi
          irigasi sederhana dan pemanfaatan pupuk organik.
        </p>
      </article>
      <article class="potensi-card">
        <h3>UMKM & Produk Lokal</h3>
        <p>
          Usaha rumahan seperti olahan pangan, kerajinan, dan jasa menjadi
          sumber penghasilan tambahan keluarga.
        </p>
      </article>
      <article class="potensi-card">
        <h3>Potensi Wisata</h3>
        <p>
          Lanskap perbukitan dan jalur alternatif menuju kawasan wisata Imogiri
          berpotensi dikembangkan sebagai wisata alam dan edukasi.
        </p>
      </article>
      <article class="potensi-card">
        <h3>Gerakan Sosial</h3>
        <p>
          Karang taruna, PKK, dan kelompok wanita tani, KTH, aktif menginisiasi program
          sosial, lingkungan, dan pendidikan nonformal.
        </p>
      </article>
    </div>
  </section>

  <!-- KEGIATAN RUTIN (TIMELINE SEDERHANA) -->
  <section id="kegiatanRutin">
    <header>
      <h2>Kegiatan Rutin Dusun</h2>
      <p>Agenda yang menjaga dusun tetap bersih, aman, dan guyub.</p>
    </header>
    <div class="timeline">
      <article class="timeline-item">
        <h3>Kerja Bakti Bulanan</h3>
        <p>
          Warga membersihkan jalan, selokan, dan fasilitas umum bersama sebagai
          bentuk kepedulian terhadap lingkungan.
        </p>
      </article>
      <article class="timeline-item">
        <h3>Posyandu & Kesehatan</h3>
        <p>
          Penimbangan balita, pemeriksaan ibu hamil, dan penyuluhan kesehatan
          rutin oleh kader dan tenaga kesehatan.
        </p>
      </article>
      <article class="timeline-item">
        <h3>Forum Remaja & Literasi Digital</h3>
        <p>
          Pertemuan pemuda untuk pelatihan teknologi, diskusi kewirausahaan,
          dan persiapan kegiatan sosial desa.
        </p>
      </article>
    </div>
  </section>

  <!-- KONTAK & INFORMASI -->
  <section id="kontakDusun">
    <div class="kontak-left">
      <h2>Kontak & Informasi Layanan</h2>
      <p>
        Untuk pengurusan administrasi, permohonan surat, atau info program
        desa, silakan hubungi perangkat dusun melalui kanal berikut.
      </p>
      <ul>
        <li>Dukuh Kajor Kulonâ€šÂ¬ Juari S.Pd.I</li>
        <li>Telp/WA: 0895-6112-58800</li>
        <li>Lokasi: Imogiri, Bantul, DI Yogyakarta</li>
      </ul>
      <button onclick="showSection('layananSuratSection')">
        Buka Layanan Surat
      </button>
    </div>
    <div class="kontak-right">
      <h3>Tips Penggunaan Aplikasi</h3>
      <p>
        Gunakan menu di kiri untuk berpindah fitur, simpan data secara
        berkala, dan manfaatkan menu Kelola Berita untuk publikasi kegiatan.
      </p>
    </div>
  </section>

 <!-- <section id="catatanWargaSection"> -->
  <!-- <header>
    <h2>Catatan & Masukan Warga</h2>
    <p>Warga dapat menulis saran singkat terkait layanan atau kondisi dusun.</p>
  </header> -->
  <!-- <div class="catatan-wrapper"> -->
    <form id="catatanForm">
      <div class="catatan-row">
        <!-- <input
          type="text"
          name="nama"
          placeholder="Nama / Inisial"
          required
        />
        <input
          type="text"
          name="rt"
          placeholder="RT (opsional)"
        />
      </div>
      <textarea
        name="isi"
        rows="3"
        placeholder="Tulis catatan, masukan, atau saran singkat di sini..."
        required
      ></textarea>
      <button type="submit">
        Kirim Catatan
      </button> -->
    </form>

    <div id="catatanList">
      <!-- daftar catatan dari localStorage -->
    </div>
  </div>
</section>
</main>


      </main>

      <section id="kependudukan" class="main-section" style="display: none">
        <h2 style="color: #24a464">Data Kependudukan</h2>
        <button class="btn-green" onclick="showForm()">
          Tambah Data Dusun
        </button>
        <table class="admin-table">
          <thead>
            <tr>
              <th>No</th>
              <th>Aksi</th>
              <th>Dusun</th>
              <th>NIK</th>
              <th>RW</th>
              <th>RT</th>
              <th>KK</th>
              <th>LP</th>
              <th>L</th>
              <th>P</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
          <tfoot>
            <tr>
              <td colspan="3">Total</td>
              <td id="total-nik">0</td>
              <td id="total-rw">0</td>
              <td id="total-rt">0</td>
              <td id="total-kk">0</td>
              <td id="total-lp">0</td>
              <td id="total-l">0</td>
              <td id="total-p">0</td>
            </tr>
          </tfoot>
        </table>
        <!-- Modal form tambah/edit data dusun -->
        <div id="form-modal">
          <form id="admin-form" onsubmit="saveData(event)">
            <h3>Tambah Data Dusun</h3>
            <input type="text" name="dusun" placeholder="Nama Dusun" required />
            <input type="number" name="nik" placeholder="NIK" required />
            <input type="number" name="rw" placeholder="RW" required />
            <input type="number" name="rt" placeholder="RT" required />
            <input type="number" name="kk" placeholder="KK" required />
            <input type="number" name="lp" placeholder="LP" required />
            <input type="number" name="l" placeholder="L" required />
            <input type="number" name="p" placeholder="P" required />
            <button type="submit">Simpan</button>
            <button type="button" onclick="closeForm()">Batal</button>
          </form>
        </div>
      </section>

      <!-- Section Surat Dinas -->
      <section id="suratDinas" class="main-section" style="display: none">
        <div class="admin-section no-print">
          <div class="toolbar" style="margin-bottom: 10px">
            <button class="btn btn-green" onclick="showFormPengaturan()">
              Tambah Surat
            </button>
            <button class="btn btn-danger" onclick="hapusSuratTerpilih()">
              Hapus Surat
            </button>
            <button class="btn btn-blue" onclick="eksporImporSurat()">
              Impor/Ekspor
            </button>
            <button class="btn" onclick="pengaturanSurat()">Pengaturan</button>
          </div>
          <input
            class="toolbar"
            id="searchSurat"
            oninput="renderDaftarSurat()"
            placeholder="kata kunci"
          />
          <table class="admin-table">
            <thead>
              <tr>
                <th>
                  <input type="checkbox" onclick="toggleAllPengaturan(this)" />
                </th>
                <th>No</th>
                <th>Aksi</th>
                <th>Nama Surat</th>
                <th>Kode/Klasifikasi</th>
                <th>Lampiran</th>
              </tr>
            </thead>
            <tbody id="tblPengaturanSurat"></tbody>
          </table>
        </div>
        <!-- Modal Form Template Surat (CRUD) -->
        <div
          class="modal-bg"
          id="modalPengaturan"
          style="display: none"
          onclick="if(event.target==this)hideModalPengaturan()"
        >
          <form class="modal-card" onsubmit="savePengaturanSurat(event)">
            <h4>Form Template Surat</h4>
            <label>Nama Surat</label>
            <input name="nama" id="formNama" required />
            <label>Kode/Klasifikasi</label>
            <input name="kode" id="formKode" />
            <label>Lampiran</label>
            <input name="lampiran" id="formLampiran" />
            <label>Perihal</label>
            <input name="perihal" id="formPerihal" required />
            <label>Isi Undangan</label>
            <textarea name="isi" id="formIsi" rows="6" required></textarea>
            <label for="inputPenutupSurat">Kalimat penutup / instruksi</label>
<textarea id="inputPenutupSurat" rows="3" placeholder="Demi kelancaran acara tersebut diharapkan para RT mempersiapkan data
Penduduk di wilayah masing masing sesuai keadaan terbaru."></textarea>

            <button class="btn btn-green" type="submit">Simpan</button>
            <button class="btn" type="button" onclick="hideModalPengaturan()">
              Batal
            </button>
          </form>
        </div>
        <!-- Panel Cetak Surat -->
        <div id="panelCetakSurat" style="display: none">
          <form class="isian-form surat-wrap" oninput="updatePreviewSurat()" onsubmit="arsipkanSurat(event)">
  <div class="form-grid-2col">
    <div class="form-group">
      <label for="inputNomorSurat">Nomor Surat</label>
      <input id="inputNomorSurat" type="text" required placeholder="contoh: 213/DS-KK/XII/2025">
    </div>

    <div class="form-group">
      <label for="inputPerihal">Perihal</label>
      <input id="inputPerihal" type="text" required placeholder="Undangan Rapat Koordinasi RT">
    </div>

    <div class="form-group">
      <label for="inputTanggalSurat">Tanggal Surat</label>
      <input id="inputTanggalSurat" type="date" required>
    </div>

    <div class="form-group">
      <label for="inputKepada">Kepada</label>
      <input id="inputKepada" type="text" required placeholder="Para Ketua RT Dusun Kajor Kulon">
    </div>
  </div>

  <div class="form-group form-full">
    <label for="inputIsiSurat">Isi Surat</label>
    <textarea id="inputIsiSurat" rows="4" required
      placeholder="Tuliskan pokok isi surat, maksud, waktu, dan tempat kegiatan."></textarea>
  </div>

  <div class="form-actions">
    <button class="btn btn-green" type="submit">Arsipkan & Cetak</button>
    <button class="btn btn-blue" type="button" onclick="modalCetakAktif()">Pratinjau Surat</button>
    <button class="btn" type="button" onclick="tutupPanelCetak()">Kembali</button>
  </div>
</form>
          <div id="previewCetakSurat" class="preview"></div>
        </div>
      </section>
      <section
        id="layananSuratSection"
        class="main-section"
        style="display: none"
      >
        <h2>Layanan Surat</h2>
        <table class="admin-table">
          <thead>
            <tr>
              <th>No</th>
              <th>Surat</th>
              <th>Tanggal</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="daftarLayananSurat"></tbody>
        </table>
        <button
          id="btnCetakSurat"
          class="btn btn-green"
          onclick="modalCetakAktif()"
          disabled
        >
          Cetak/Download
        </button>
      </section>

      <section
        id="beritaSection"
        class="main-section"
        style="display: none; padding: 36px 0"
      >
        <h2 style="text-align: center; color: #16875e; margin-bottom: 8px">
          Berita Terkini Desa Kajor Kulon
        </h2>
        <p
          style="
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-bottom: 25px;
          "
        >
          Info & kabar penting seputar kegiatan, layanan, dan inovasi desa.
        </p>
        <div id="beritaGrid" class="berita-grid"></div>
      </section>

      <section
        id="artikelSection"
        class="main-section"
        style="display: none; padding: 36px 0"
      >
        <h2 style="text-align: center; color: #1c8e65; margin-bottom: 8px">
          Artikel & Info Desa
        </h2>
        <div id="artikelGrid" class="artikel-grid"></div>
      </section>

      <section id="mapsdesaSection" class="main-section" style="display: none">
        <h2 style="text-align: center; color: #1589c9; margin: 22px 0 14px 0">
          Peta Wilayah Kajor Kulon & 6 RT (Imogiri, Bantul)
        </h2>
        <!-- Di HTML -->
<div id="mapsContainer" style="width:100%; max-width:950px; height:450px; margin:0 auto 30px auto; border-radius:13px; overflow:hidden;"></div>

        <p style="text-align: center; color: #444">
          Pilih tipe map di pojok kanan &#9776;. Klik tiap RT untuk info,
          geser/perbesar peta, atau tambahkan file GeoJSON asli jika ada.
        </p>
      </section>
      <section id="cuacaTanamSection" class="main-section" style="display:none">
  <header class="blok-header">
    <span class="tag-mini">Cuaca & Tanam</span>
    <h2>Peringatan Cuaca & Jadwal Tanam</h2>
    <p>Ringkasan cuaca hari ini di Kajor Kulon dan saran jadwal tanam sederhana untuk padi dan palawija.</p>
  </header>

  <!-- Notifikasi perubahan cuaca -->
  <div id="ctNotif" class="ct-notif" style="display:none;"></div>

  <div class="cuaca-tanam-wrap">
    <!-- Kartu kiri: cuaca -->
    <article class="cuaca-card">
      <div class="cuaca-top">
        <div>
          <h3>Cuaca Hari Ini</h3>
          <span id="ctTanggal" class="ct-tanggal">â€“</span>
        </div>
        <div class="ct-badge" id="ctBadge">Memuat...</div>
      </div>

      <div class="cuaca-middle">
        <div class="ct-suhu-blok">
          <span id="ctSuhu" class="ct-suhu">â€“Â°C</span>
          <span id="ctKondisi" class="ct-kondisi">â€“</span>
        </div>
        <div class="ct-detail">
          <span id="ctHujan">Hujan: â€“ mm</span>
          <span id="ctKelembapan">Kelembapan: â€“%</span>
          <span id="ctAngin">Angin: â€“ m/s</span>
        </div>
      </div>

      <footer class="cuaca-footer">
        <small>Data otomatis diperbarui untuk koordinat Dusun Kajor Kulon.</small>
      </footer>
    </article>

    <!-- Kartu kanan: rekomendasi tanam -->
    <article class="tanam-card">
      <h3>Rekomendasi Jadwal Tanam</h3>
      <p id="ctRingkasan" class="tanam-ringkasan">
        Sistem membaca pola hujan & suhu harian untuk memberi saran tanam yang mudah dipahami petani.
      </p>
      <ul class="tanam-ul">
        <li id="ctPadi"><strong>Padi:</strong> â€“</li>
        <li id="ctPalawija"><strong>Palawija:</strong> â€“</li>
        <li id="ctCatatan"><strong>Catatan Lapangan:</strong> â€“</li>
      </ul>
    </article>
  </div>
</section>


      <!-- ADMIN KELola BERITA/ARTIKEL -->
      <section
        id="kelolaBeritaSection"
        class="main-section"
        style="display: none; padding: 32px 0"
      >
        <h2>Kelola Berita/Artikel</h2>
        <form id="formBerita" style="max-width: 450px; margin: 20px auto">
          <label
            >Judul<br />
            <input
              type="text"
              name="title"
              required
              style="width: 100%"
            /> </label
          ><br />
          <label
            >Penulis<br />
            <input
              type="text"
              name="author"
              required
              style="width: 100%"
            /> </label
          ><br />
          <label
            >Kategori<br />
            <select name="kategori" required>
              <option value="berita">Berita</option>
              <option value="artikel">Artikel</option>
            </select> </label
          ><br />
          <label
            >Tanggal<br />
            <input
              type="date"
              name="date"
              required
              style="width: 100%"
            /> </label
          ><br />
          <div class="form-group">
  <label>URL Gambar / File (opsional)</label>
  <input type="text" name="urlGambar" class="form-control"
         placeholder="https://...jpg / .png / .pdf">
</div>

          <label
            >Ringkasan<br />
            <textarea
              name="desc"
              required
              style="width: 100%"
            ></textarea></label
          ><br />
          <button type="submit">Tambah</button>
        </form>
        <div id="daftarBeritaAdmin">
  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Judul</th>
        <th>Kategori</th>
        <th>Preview</th>
        <th>Tanggal</th>
        <th>Hapus</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

      </section>
      <!-- Tambahkan sebelum </body> -->
      <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet/dist/leaflet.css"
      />
      <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    </div>
    <div class="modal-bg" id="modalBerita">
      <form class="modal-form" onsubmit="saveBerita(event)">
        <h3 id="modalJudul">Tambah Berita/Artikel</h3>
        <label>Judul</label>
        <input type="text" id="inputJudul" required />
        <label>Gambar (URL/link)</label>
        <input
          type="text"
          id="inputGambar"
          placeholder="Contoh: https://..."
          required
        />
        <label>Penulis</label>
        <input type="text" id="inputPenulis" required />
        <label>Tanggal</label>
        <input type="date" id="inputTanggal" required />
        <label>Isi</label>
        <textarea id="inputIsi" rows="3" required></textarea>
        <label>Kategori</label>
        <select id="inputKategori">
          <option value="berita">Berita</option>
          <option value="artikel">Artikel</option>
        </select>
        <button type="submit">Simpan</button>
        <button type="button" onclick="closeModal(event)">Batal</button>
      </form>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      // Sidebar toggle
      const sidebar = document.getElementById("sidebarNav");
      const hamburgerBtn = document.getElementById("hamburgerBtn");
      hamburgerBtn.onclick = () => {
        sidebar.classList.toggle("closed");
        hamburgerBtn.classList.toggle("shifted");
      };

      // Show/hide sections based on menu
      function showSection(sectionId) {
        const allSections = [
          "kependudukan",
          "suratDinas",
          "sliderSection",
          "beritaSection",
          "artikelSection",
          "mapsdesaSection",
          "kelolaBeritaSection",
        ];
        allSections.forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.style.display = id === sectionId ? "block" : "none";
        });

        if (sectionId === "kependudukan") {
  renderTable();
}


        // Update active menu item
        document.querySelectorAll(".menu-item").forEach((el) => {
          el.classList.toggle(
            "active",
            el.getAttribute("onclick") === `showSection('${sectionId}')`
          );
        });

        // Load data per section
        if (sectionId === "") renderSlider();
        if (sectionId === "beritaSection") renderBeritaSheets();
        if (sectionId === "artikelSection") renderArtikelSheets();
        if (sectionId === "kelolaBeritaSection") renderAdminList();
        if (sectionId === "mapsdesaSection") initMap();
      }
      let dataDusun = [];
      let currentEdit = null;

      function showForm(index = null) {
        const modal = document.getElementById("form-modal");
        modal.style.display = "flex";
        currentEdit = index;
        const form = document.getElementById("admin-form");
        if (index !== null) {
          const entry = dataDusun[index];
          form.dusun.value = entry.dusun;
          form.nik.value = entry.nik;
          form.rw.value = entry.rw;
          form.rt.value = entry.rt;
          form.kk.value = entry.kk;
          form.lp.value = entry.lp;
          form.l.value = entry.l;
          form.p.value = entry.p;
        } else {
          form.reset();
        }
      }
      function closeForm() {
        document.getElementById("form-modal").style.display = "none";
      }
      async function saveData(event) {
  event.preventDefault();
  const form = event.target;
  const entry = {
    Dusun: form.dusun.value,
    NIK: form.nik.value,
    RW: form.rw.value,
    RT: form.rt.value,
    KK: form.kk.value,
    LP: form.lp.value,
    L: form.l.value,
    P: form.p.value,
  };

  try {
    await apiTambah(entry, 'Kependudukan');   // simpan ke Google Sheets
    closeForm();                              // tutup modal
    renderTable();                            // reload tabel dari server
    alert('Data tersimpan ke server');
  } catch (err) {
    console.error(err);
    alert('Gagal menyimpan data');
  }
}


      function updateTable() {
        const tbody = document.getElementById("table-body");
        tbody.innerHTML = "";
        let totals = { nik: 0, rw: 0, rt: 0, kk: 0, lp: 0, l: 0, p: 0 };
        dataDusun.forEach((entry, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>
          <button onclick="showForm(${idx})">Edit</button>
          <button class="btn-danger" onclick="deleteRow(${idx})">Hapus</button>
        </td>
        <td>${entry.dusun}</td><td>${entry.nik}</td><td>${entry.rw}</td><td>${
            entry.rt
          }</td><td>${entry.kk}</td><td>${entry.lp}</td><td>${
            entry.l
          }</td><td>${entry.p}</td>
      `;
          tbody.appendChild(tr);
          totals.nik += Number(entry.nik);
          totals.rw += Number(entry.rw);
          totals.rt += Number(entry.rt);
          totals.kk += Number(entry.kk);
          totals.lp += Number(entry.lp);
          totals.l += Number(entry.l);
          totals.p += Number(entry.p);
        });
        // Update totals display
        document.getElementById("total-nik").textContent = totals.nik;
        document.getElementById("total-rw").textContent = totals.rw;
        document.getElementById("total-rt").textContent = totals.rt;
        document.getElementById("total-kk").textContent = totals.kk;
        document.getElementById("total-lp").textContent = totals.lp;
        document.getElementById("total-l").textContent = totals.l;
        document.getElementById("total-p").textContent = totals.p;
      }
      function deleteRow(idx) {
        if (confirm("Yakin ingin hapus data ini?")) {
          dataDusun.splice(idx, 1);
          updateTable();
        }
      }

      // Surat Dinas
      // Surat dinas data
      let daftarSurat = JSON.parse(
        localStorage.getItem("daftarSuratDinas") || "[]"
      );
      let editingIdx = null;

      function renderDaftarSurat() {
        const tbody = document.getElementById("tblPengaturanSurat");
        const keyword = document
          .getElementById("searchSurat")
          .value.toLowerCase();
        let filtered = daftarSurat.filter(
          (d) =>
            d.nama.toLowerCase().includes(keyword) ||
            (d.kode && d.kode.toLowerCase().includes(keyword))
        );
        if (filtered.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="6" style="text-align:center;">Tidak ada data yang tersedia pada tabel</td></tr>';
          return;
        }
        tbody.innerHTML = filtered
          .map(
            (d, idx) => `
    <tr>
      <td><input type="checkbox" data-idx="${idx}"></td>
      <td>${idx + 1}</td>
      <td>
        <button class="btn btn-blue" onclick="showFormPengaturan(${idx})"><i class="fa fa-edit"></i></button>
        <button class="btn btn-green" onclick="langsungCetakSurat(${idx})"><i class="fa fa-print"></i></button>
        <button class="btn btn-danger" onclick="hapusSuratPengaturan(${idx})"><i class="fa fa-trash"></i></button>
      </td>
      <td>${d.nama}</td>
      <td>${d.kode}</td>
      <td>${d.lampiran}</td>
    </tr>
  `
          )
          .join("");
      }

      function showFormPengaturan(idx = null) {
        const modal = document.getElementById("modalPengaturan");
        const form = modal.querySelector("form");
        editingIdx = idx;
        modal.style.display = "flex";
        if (idx !== null) {
          let surat = daftarSurat[idx];
          form.nama.value = surat.nama;
          form.kode.value = surat.kode;
          form.lampiran.value = surat.lampiran;
          form.perihal.value = surat.perihal;
          form.isi.value = surat.isi;
        } else {
          form.reset();
        }
      }
      function hideModalPengaturan() {
        document.getElementById("modalPengaturan").style.display = "none";
      }
      function savePengaturanSurat(e) {
        e.preventDefault();
        let f = e.target;
        let surat = {
          nama: f.nama.value,
          kode: f.kode.value,
          lampiran: f.lampiran.value,
          perihal: f.perihal.value,
          isi: f.isi.value,
        };
        if (editingIdx !== null) {
          daftarSurat[editingIdx] = surat;
        } else {
          daftarSurat.push(surat);
        }
        localStorage.setItem("daftarSuratDinas", JSON.stringify(daftarSurat));
        hideModalPengaturan();
        renderDaftarSurat();
      }
      function hapusSuratPengaturan(idx) {
        if (!confirm("Yakin hapus data surat ini?")) return;
        daftarSurat.splice(idx, 1);
        localStorage.setItem("daftarSuratDinas", JSON.stringify(daftarSurat));
        renderDaftarSurat();
      }
      function toggleAllPengaturan(masterCheckbox) {
        document
          .querySelectorAll("#tblPengaturanSurat input[type='checkbox']")
          .forEach((cb) => (cb.checked = masterCheckbox.checked));
      }
      function hapusSuratTerpilih() {
        let checkboxes = document.querySelectorAll(
          "#tblPengaturanSurat input[type='checkbox']:checked"
        );
        let toDelete = [...checkboxes].map((cb) => Number(cb.dataset.idx));
        if (toDelete.length === 0) {
          alert("Tidak ada surat yang dipilih.");
          return;
        }
        if (!confirm(`Yakin hapus ${toDelete.length} surat?`)) return;
        toDelete
          .sort((a, b) => b - a)
          .forEach((idx) => daftarSurat.splice(idx, 1));
        localStorage.setItem("daftarSuratDinas", JSON.stringify(daftarSurat));
        renderDaftarSurat();
      }

      function langsungCetakSurat(idx) {
        document.getElementById("panelCetakSurat").style.display = "block";
        let surat = daftarSurat[idx];
        document.getElementById("inputNomorSurat").value = surat.kode || "";
        document.getElementById("inputPerihal").value = surat.perihal || "";
        document.getElementById("inputTanggalSurat").value = new Date()
          .toISOString()
          .substr(0, 10);
        document.getElementById("inputKepada").value =
          "Para Ketua RT Dusun Kajor Kulon"; // bisa dinamis
        document.getElementById("inputIsiSurat").value = surat.isi || "";
        updatePreviewSurat();
      }
      function tutupPanelCetak() {
        document.getElementById("panelCetakSurat").style.display = "none";
      }

      // helper kirim template ke sheet "suratdinas"
async function simpanSuratBaruKeSheet(nama, kode, lampiran, perihal, isi) {
  const data = {
    Nama: nama,
    Kode: kode,
    Lampiran: lampiran || "",
    Perihal: perihal || "",
    Isi: isi || ""
  };

  try {
    await apiTambah(data, "suratdinas");
    await loadSuratDinasFromSheet();  // refresh tabel dari sheet
  } catch (e) {
    console.error("Gagal simpanSuratBaruKeSheet:", e);
    alert("Gagal menyimpan template ke spreadsheet.");
  }
}


      // Preview output 100% mirip surat asli
      function updatePreviewSurat() {
  const nomorSurat   = document.getElementById("inputNomorSurat").value;
  const perihal      = document.getElementById("inputPerihal").value;
  const tanggalSurat = document.getElementById("inputTanggalSurat").value;
  const kepada       = document
    .getElementById("inputKepada")
    .value.replace(/\n/g, "<br>");
  const isiInput     = document.getElementById("inputIsiSurat").value || "";
  const penutupInput = document.getElementById("inputPenutupSurat").value
    || "Demi kelancaran acara tersebut diharapkan para RT mempersiapkan data\nPenduduk di wilayah masing masing sesuai keadaan terbaru.";

  let tglCetak = tanggalSurat ? new Date(tanggalSurat) : new Date();
  let bulanID  = tglCetak.toLocaleString("id-ID", { month: "long" });
  let tempat   = "Kajor Kulon";

  const isi = `
    ${isiInput.replace(/\n/g, "<br>")}<br><br>
    Hari&nbsp;&nbsp;&nbsp;&nbsp;: Sabtu<br>
    Tanggal : ${tglCetak.getDate()} ${bulanID} ${tglCetak.getFullYear()}<br>
    Waktu&nbsp;&nbsp;: Pukul 08.00 s/d Selesai<br>
    Tempat : Balai Dusun Kajor Kulon<br><br>
    ${penutupInput.replace(/\n/g, "<br>")}
  `;

  document.getElementById("previewCetakSurat").innerHTML = `
  <div style="text-align:center;font-weight:bold;">
    <img src="Logo-Kajor-Kulon.png" style="width:100px;float:left;margin-right:14px;">
    <div style="font-size:18px;">PEMERINTAH KABUPATEN BANTUL<br>KAPANEWON IMOGIRI<br>DUSUN KAJOR KULON</div>
    <div style="font-size:14px;margin-bottom:8px;">Kalurahan Selopamioro, Kapanewon Imogiri, Kabupaten Bantul, Daerah Istimewa Yogyakarta</div>
    <div style="border-bottom:2px solid #333;width:95%;margin:0 auto 12px auto;"></div>
  </div>
  <table style="margin-bottom:8px;">
    <tr>
      <td>Nomor</td><td>: ${nomorSurat}</td>
      <td style="padding-left:30px;">${tempat}, ${tglCetak.getDate()} ${bulanID} ${tglCetak.getFullYear()}</td>
    </tr>
    <tr><td>Lampiran</td><td>: -</td></tr>
    <tr><td>Perihal</td><td>: ${perihal}</td></tr>
  </table>
  <div>Kepada Yth.<br>${kepada}<br>Di Tempat</div>
  <br>
  <div>Dengan hormat,<br>${isi}</div><br>
  <div style="margin-top:20px;">
    Bantul, ${tglCetak.getDate()} ${bulanID} ${tglCetak.getFullYear()}<br>
    Bapak Dusun Kajor Kulon<br><br><br>
    <b>Juari S.Pd I</b>
  </div>`;
}


      // Cetak surat - hanya panel preview yang tampil ditampilan print
      function modalCetakAktif() {
        window.print();
      }

      // Arsipkan surat
      function arsipkanSurat(e) {
        e.preventDefault();
        alert("Surat berhasil diarsipkan!"); // Replace with any proper archive logic if needed
        tutupPanelCetak();
      }
      function renderLayananSurat() {
        let layananSurat = JSON.parse(
          localStorage.getItem("layananSurat") || "[]"
        );
        let tbody = document.getElementById("daftarLayananSurat");
        if (!tbody) return;
        if (!layananSurat.length) {
          tbody.innerHTML =
            '<tr><td colspan="5" style="text-align:center;">Belum ada surat</td></tr>';
          return;
        }
        tbody.innerHTML = layananSurat
          .map(
            (s, i) => `
    <tr>
      <td>${i + 1}</td>
      <td>${s.nama}</td>
      <td>${s.tanggal}</td>
      <td>
        <span style="font-weight:600;color:${
          s.status === "Sudah ACC Dukuh" ? "green" : "darkorange"
        };">${s.status}</span>
      </td>
      <td>
        <button class="btn" onclick="accSurat(${i})">ACC Dukuh</button>
        ${
          s.status === "Sudah ACC Dukuh"
            ? `<button class="btn btn-green" onclick="bukaCetakSurat(${i})">Cetak</button>`
            : ""
        }
      </td>
    </tr>
  `
          )
          .join("");
      }
      function accSurat(idx) {
        let layananSurat = JSON.parse(
          localStorage.getItem("layananSurat") || "[]"
        );
        layananSurat[idx].status = "Sudah ACC Dukuh";
        localStorage.setItem("layananSurat", JSON.stringify(layananSurat));
        renderLayananSurat();
      }

      function bukaCetakSurat(idx) {
        // Isi form cetak menggunakan surat yang sudah di ACC
        let layananSurat = JSON.parse(
          localStorage.getItem("layananSurat") || "[]"
        );
        let s = layananSurat[idx];
        showSection("suratDinas");
        document.getElementById("panelCetakSurat").style.display = "block";
        document.getElementById("inputPerihal").value = s.nama;
        document.getElementById("inputNomorSurat").value = s.nomor;
        document.getElementById("inputTanggalSurat").value = s.tanggal;
        document.getElementById("inputKepada").value = s.kepada;
        document.getElementById("inputIsiSurat").value = s.isi;
        document.getElementById("btnCetakSurat").disabled = false;
        updatePreviewSurat(); // jika ada
      }

      function showSection(sectionId) {
        document
          .querySelectorAll(".main-section")
          .forEach((s) => (s.style.display = "none"));
        let sec = document.getElementById(sectionId);
        if (sec) sec.style.display = "block";
        if (sectionId === "mapsdesaSection")
          setTimeout(renderMapKajorKulon, 10);
      }
      // Admin Berita CRUD
      function renderAdminList() {
        const data = getBeritaData();
        const container = document.getElementById("adminList");
        if (!container) return;
        container.innerHTML = data
          .map(
            (b, i) => `
    <div class="admin-card" draggable="false">
      <img src="${b.gambar}" alt="" draggable="false"/>
      <div style="font-weight: bold; margin-top: 6px">${b.judul}</div>
      <div class="news-meta">${b.tanggal} | ${
              b.penulis
            } <span style="float:right; color:#25c982;">${
              b.kategori
            }</span></div>
      <div style="font-size: 13px; color: #4b5957; margin: 9px 0 6px 0;">${b.isi.slice(
        0,
        76
      )}...</div>
      <div class="btn-group">
        <button class="edit-btn" onclick="openModal(${i})"><i class="fa fa-pencil"></i> Edit</button>
        <button class="delete-btn" onclick="deleteBerita(${i})"><i class="fa fa-trash"></i> Hapus</button>
      </div>
    </div>`
          )
          .join("");
      }

      let editIdx = -1;
      function openModal(idx) {
        editIdx = idx;
        document.getElementById("modalBerita").style.display = "flex";
        if (idx >= 0) {
          const b = getBeritaData()[idx];
          document.getElementById("inputJudul").value = b.judul;
          document.getElementById("inputGambar").value = b.gambar;
          document.getElementById("inputPenulis").value = b.penulis;
          document.getElementById("inputTanggal").value = b.tanggal;
          document.getElementById("inputIsi").value = b.isi;
          document.getElementById("inputKategori").value = b.kategori;
          document.getElementById("modalJudul").textContent =
            "Edit Berita/Artikel";
        } else {
          document.querySelector(".modal-form").reset();
          document.getElementById("modalJudul").textContent =
            "Tambah Berita/Artikel";
        }
      }
      function closeModal(e) {
        if (e) e.preventDefault();
        document.getElementById("modalBerita").style.display = "none";
      }
      function saveBerita(e) {
        e.preventDefault();
        let data = getBeritaData();
        const obj = {
          judul: document.getElementById("inputJudul").value,
          gambar: document.getElementById("inputGambar").value,
          penulis: document.getElementById("inputPenulis").value,
          tanggal: document.getElementById("inputTanggal").value,
          isi: document.getElementById("inputIsi").value,
          kategori: document.getElementById("inputKategori").value,
        };
        if (editIdx >= 0) data[editIdx] = obj;
        else data.unshift(obj);
        localStorage.setItem("ka_news_pro_v2", JSON.stringify(data));
        closeModal();
        renderAdminList();
      }
      function deleteBerita(idx) {
        if (!confirm("Hapus data ini?")) return;
        let data = getBeritaData();
        data.splice(idx, 1);
        localStorage.setItem("ka_news_pro_v2", JSON.stringify(data));
        renderAdminList();
      }
      document.getElementById("modalBerita").onclick = function (e) {
        if (e.target === this) closeModal();
      };

      // Peta Desa
      function renderMapKajorKulon() {
        // Hapus map lama pada reload menu
        if (window._desaMap && window._desaMap.remove) window._desaMap.remove();

        // CENTER sesuai Google Maps lokasi Kajor Kulon
        const CENTER = [ -7.962999, 110.386446];
        window._desaMap = L.map("mapsContainer").setView([ -7.962999, 110.386446], 16);

        // Basemap/layer kontrol
        const street = L.tileLayer(
          "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
          { maxZoom: 20, attribution: "By KKNM UNY 24036Â© OpenStreetMap" }
        );
        const satellite = L.tileLayer(
          "https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",
          {
            subdomains: ["mt0", "mt1", "mt2", "mt3"],
            attribution: "Google Satellite",
          }
        );
        const hybrid = L.tileLayer(
          "https://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",
          {
            subdomains: ["mt0", "mt1", "mt2", "mt3"],
            attribution: "Google Hybrid",
          }
        );
        const terrain = L.tileLayer(
          "https://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",
          {
            subdomains: ["mt0", "mt1", "mt2", "mt3"],
            attribution: "Google Terrain",
          }
        );
        let baseLayers = {
          Street: street,
          Satellite: satellite,
          Hybrid: hybrid,
          Terrain: terrain,
        };
        street.addTo(window._desaMap);
        L.control.layers(baseLayers).addTo(window._desaMap);

        // POLYGON BATAS 6 RT dalam Dusun Kajor Kulon (perkiraan bentuk, bisa tracing manual di geojson.io)
        // SKETSA 6 RT MENGELILINGI CENTER (bentuk mirip gambar, semua polygon saling bersinggungan)
// SKETSA 6 RT, DIGESER KE TIMUR, SISI BARAT RT 05 DI TITIK CENTER
const OFFSET_EAST = 0.0004; // geser semua RT sedikit ke timur
// helper: [lng, lat, 0] GeoJSON -> [lat, lng] Leaflet
function fromGeoJson(coords) {
  return coords.map(c => [c[1], c[0]]);
}

// POLYGON BATAS 6 RT di sekitar CENTER (sketsa menyesuaikan SS)
// SKETSA 6 RT MENYERUPAI GAMBAR, CENTER DI DALAM RT 05
// === RT 05 DARI GEOJSON ===
// Catatan: di GeoJSON urutannya [lng, lat], di Leaflet harus [lat, lng]


// === KOORDINAT GEOJSON PER RT ===

// RT 01
const geo_rt01 = [ [ 110.386416729154107, -7.960867498142826, 0.0 ], [ 110.3864598316122, -7.960623075551868, 0.0 ], [ 110.386459227376903, -7.960479163745511, 0.0 ], [ 110.386403631010893, -7.960243294490527, 0.0 ], [ 110.386405747768606, -7.960066667544591, 0.0 ], [ 110.386389716415295, -7.959918203866116, 0.0 ], [ 110.386482919929094, -7.95968844520115, 0.0 ], [ 110.386561230815204, -7.959657566330137, 0.0 ], [ 110.386647775325002, -7.959572438496353, 0.0 ], [ 110.386746509435696, -7.959494534116775, 0.0 ], [ 110.386840273771099, -7.959379449809449, 0.0 ], [ 110.386942319381106, -7.95923595912975, 0.0 ], [ 110.387085105770097, -7.959188669107298, 0.0 ], [ 110.387227149138695, -7.959217755284934, 0.0 ], [ 110.387477791288703, -7.959351462742412, 0.0 ], [ 110.387641240114206, -7.959476240316995, 0.0 ], [ 110.387816876566006, -7.959635850678822, 0.0 ], [ 110.388005356989893, -7.959821864659768, 0.0 ], [ 110.388306175569795, -7.960135598837071, 0.0 ], [ 110.3881486135069, -7.960256854254271, 0.0 ], [ 110.388009563419004, -7.960599569956656, 0.0 ], [ 110.387755930353507, -7.96074856491156, 0.0 ], [ 110.387725628847704, -7.960888630871096, 0.0 ], [ 110.387699543336396, -7.961004058457089, 0.0 ], [ 110.387669162024395, -7.961122279357853, 0.0 ], [ 110.3871875393436, -7.961108894147335, 0.0 ], [ 110.387184931419895, -7.961067034723057, 0.0 ], [ 110.387102932887899, -7.961013560384094, 0.0 ], [ 110.3867476598829, -7.960983550263605, 0.0 ], [ 110.386680506969, -7.96101608696582, 0.0 ], [ 110.386416729154107, -7.960867498142826, 0.0 ] ];

// RT 02
const geo_rt02 = [ [ 110.388309656974698, -7.960126778949097, 0.0 ], [ 110.389947701250804, -7.958792180469853, 0.0 ], [ 110.391281160971403, -7.958530743453084, 0.0 ], [ 110.391501372960903, -7.958517055991172, 0.0 ], [ 110.391950716588994, -7.959942141491058, 0.0 ], [ 110.390770905982293, -7.960255620392529, 0.0 ], [ 110.390707367207995, -7.960781959110458, 0.0 ], [ 110.389705739528694, -7.960867550638611, 0.0 ], [ 110.389648407276496, -7.960634737893952, 0.0 ], [ 110.3888531826437, -7.960330700496165, 0.0 ], [ 110.388309656974698, -7.960126778949097, 0.0 ] ];

// RT 03
const geo_rt03 = [ [ 110.388990153661496, -7.961585935400905, 0.0 ], [ 110.389700142561907, -7.960878748394692, 0.0 ], [ 110.389658663836798, -7.960626856195129, 0.0 ], [ 110.388302763842205, -7.960142658633464, 0.0 ], [ 110.388156445423405, -7.9602504763657, 0.0 ], [ 110.388006459461096, -7.960615908851774, 0.0 ], [ 110.387770300456097, -7.960748909383621, 0.0 ], [ 110.387675445768906, -7.961129698948309, 0.0 ], [ 110.388009387341796, -7.961142024578005, 0.0 ], [ 110.387894690946695, -7.96182077969172, 0.0 ], [ 110.388064767948507, -7.96184591417685, 0.0 ], [ 110.388342823753007, -7.961860417971417, 0.0 ], [ 110.388632184865003, -7.961784869094369, 0.0 ], [ 110.388763108963005, -7.961731296946265, 0.0 ], [ 110.388990153661496, -7.961585935400905, 0.0 ] ];

const geo_rt04 = [ [ 110.386054362488807, -7.962563668093419, 0.0 ], [ 110.385852832612699, -7.962316444043872, 0.0 ], [ 110.385712376106, -7.962135406742402, 0.0 ], [ 110.385745207116699, -7.961954703553662, 0.0 ], [ 110.3857441626254, -7.961741660984337, 0.0 ], [ 110.385724028419304, -7.961595244898542, 0.0 ], [ 110.385707957375701, -7.961401520751667, 0.0 ], [ 110.385716308524195, -7.961207877303847, 0.0 ], [ 110.385836904492095, -7.961140616353807, 0.0 ], [ 110.386035324373907, -7.961072801071594, 0.0 ], [ 110.386174055976696, -7.961060006211199, 0.0 ], [ 110.386254380496894, -7.961013523073564, 0.0 ], [ 110.386360727067398, -7.960930868229644, 0.0 ], [ 110.386421939174596, -7.960854362361927, 0.0 ], [ 110.386539585036502, -7.960930111730123, 0.0 ], [ 110.386685133775501, -7.961014890713846, 0.0 ], [ 110.3867637117051, -7.960988070433907, 0.0 ], [ 110.386888966350995, -7.961028599739184, 0.0 ], [ 110.387021403547607, -7.96103018610455, 0.0 ], [ 110.387135385667904, -7.961030160408352, 0.0 ], [ 110.387192082337904, -7.961069124227796, 0.0 ], [ 110.387176747271297, -7.961123709191419, 0.0 ], [ 110.387245495396201, -7.961122281039456, 0.0 ], [ 110.387338100167099, -7.961132416035996, 0.0 ], [ 110.387427294521004, -7.961141129738627, 0.0 ], [ 110.387512486514495, -7.961112070654131, 0.0 ], [ 110.387596992915803, -7.961113418288308, 0.0 ], [ 110.387666689381405, -7.961135720223286, 0.0 ], [ 110.387786414284605, -7.961116992009194, 0.0 ], [ 110.388010954120205, -7.961140560850177, 0.0 ], [ 110.387944948868906, -7.961613700499098, 0.0 ], [ 110.387877450183296, -7.961833477048212, 0.0 ], [ 110.387671798540495, -7.961776290035437, 0.0 ], [ 110.387520815202507, -7.961784660225608, 0.0 ], [ 110.387309096712102, -7.961812585075334, 0.0 ], [ 110.387086339540105, -7.961906278987156, 0.0 ], [ 110.386916817495802, -7.962087742647959, 0.0 ], [ 110.386756646609001, -7.962199634368029, 0.0 ], [ 110.386610023199395, -7.962341536935124, 0.0 ], [ 110.386054362488807, -7.962563668093419, 0.0 ]
];
// RT 05 dari file besar 1f9d7ca0... (rt5Coords sudah ada di file)
// di sana sudah [lat,lng], jadi tidak perlu fromGeoJson lagi:
const geo_rt05 = [
  [ 110.386065154059395, -7.962472719046849, 0.0 ], [ 110.386102315830698, -7.962406235269453, 0.0 ], [ 110.386168237811901, -7.962436141234878, 0.0 ], [ 110.386227984621797, -7.962448237976806, 0.0 ], [ 110.386282244624695, -7.962434269972432, 0.0 ], [ 110.386330382371696, -7.962392954481063, 0.0 ], [ 110.386394973699694, -7.962355123967831, 0.0 ], [ 110.386448946915905, -7.96228190737029, 0.0 ], [ 110.3864656742699, -7.962235206300798, 0.0 ], [ 110.386516580925104, -7.962258202400407, 0.0 ], [ 110.386564330494295, -7.962327087642556, 0.0 ], [ 110.386583549224397, -7.962344739201407, 0.0 ], [ 110.386071258121703, -7.962594647402678, 0.0 ], [ 110.386083867227597, -7.962639279907324, 0.0 ], [ 110.386112991935903, -7.962742369864384, 0.0 ], [ 110.386137866618895, -7.962829891904402, 0.0 ], [ 110.386153317515394, -7.962886405573995, 0.0 ], [ 110.386171265484407, -7.962954888468883, 0.0 ], [ 110.386244769737402, -7.963022003575841, 0.0 ], [ 110.386283502351503, -7.963071698922279, 0.0 ], [ 110.386309160604895, -7.963122512596903, 0.0 ], [ 110.386336639900605, -7.963175597061981, 0.0 ], [ 110.386377465125804, -7.963227851031577, 0.0 ], [ 110.386417960257305, -7.963279682873962, 0.0 ], [ 110.386441008013904, -7.963318003672081, 0.0 ], [ 110.386457229867005, -7.963329942010353, 0.0 ], [ 110.386518827339202, -7.963417539281878, 0.0 ], [ 110.386570734589895, -7.9634664920941, 0.0 ], [ 110.386612558019095, -7.963528748098031, 0.0 ], [ 110.386660945246703, -7.963564714780934, 0.0 ], [ 110.386711819419801, -7.96361270743418, 0.0 ], [ 110.386771427012107, -7.963646151025037, 0.0 ], [ 110.386818607940299, -7.96368113377413, 0.0 ], [ 110.386843875672895, -7.963730974379746, 0.0 ], [ 110.386865928687698, -7.96376798504148, 0.0 ], [ 110.386918390386796, -7.963827095226713, 0.0 ], [ 110.386955321119601, -7.963874741782904, 0.0 ], [ 110.386990658697101, -7.963920287320792, 0.0 ], [ 110.387037659498603, -7.963964005371505, 0.0 ], [ 110.387072563161595, -7.964009044862714, 0.0 ], [ 110.387092708211895, -7.964043427951258, 0.0 ], [ 110.387129956947206, -7.96409981100603, 0.0 ], [ 110.387152688093195, -7.964145738590651, 0.0 ], [ 110.387187145521906, -7.964190106855766, 0.0 ], [ 110.387222343776898, -7.964235472902573, 0.0 ], [ 110.387245579011307, -7.96428184081777, 0.0 ], [ 110.387279549575894, -7.964325536543534, 0.0 ], [ 110.3873028104192, -7.964379809648692, 0.0 ], [ 110.3873357905793, -7.964422124651362, 0.0 ], [ 110.387368930964598, -7.964464666628658, 0.0 ], [ 110.3873884528183, -7.964497773321756, 0.0 ], [ 110.387436369398799, -7.964551261279369, 0.0 ], [ 110.387458044986502, -7.964595017156293, 0.0 ], [ 110.387491265270299, -7.964637609771327, 0.0 ], [ 110.387521798668701, -7.964668861986666, 0.0 ], [ 110.387577214431403, -7.9647085060897, 0.0 ], [ 110.387631227435904, -7.964746560345692, 0.0 ], [ 110.387659994264297, -7.964775785338733, 0.0 ], [ 110.3876992970918, -7.964802928404915, 0.0 ], [ 110.387757596235602, -7.964878020118992, 0.0 ], [ 110.387810293248606, -7.964922565381698, 0.0 ], [ 110.387850178734595, -7.964958462174685, 0.0 ], [ 110.387878738249796, -7.964995337961249, 0.0 ], [ 110.387894849769197, -7.965023920089974, 0.0 ], [ 110.387936284427596, -7.965069726615089, 0.0 ], [ 110.387966945477203, -7.965117138643779, 0.0 ], [ 110.387974099189606, -7.965157171308925, 0.0 ], [ 110.388003038820699, -7.965194563964607, 0.0 ], [ 110.388023040645393, -7.965243323205926, 0.0 ], [ 110.388041246579704, -7.965282011361861, 0.0 ], [ 110.388048555403998, -7.965321639624008, 0.0 ], [ 110.388059242687305, -7.965380333489509, 0.0 ], [ 110.388066256558204, -7.96541906770631, 0.0 ], [ 110.388052096743294, -7.965460163868708, 0.0 ], [ 110.388048558465002, -7.965499686557656, 0.0 ], [ 110.388069617144893, -7.96549708109236, 0.0 ], [ 110.388087238724793, -7.96547538940689, 0.0 ], [ 110.388149380037504, -7.965398895242398, 0.0 ], [ 110.388176413741107, -7.96536610414968, 0.0 ], [ 110.388214337877002, -7.965332024877323, 0.0 ], [ 110.388269345853899, -7.965266256601494, 0.0 ], [ 110.388307800073207, -7.965231961940791, 0.0 ], [ 110.388347975277398, -7.965207584153065, 0.0 ], [ 110.388377636605796, -7.965184823019712, 0.0 ], [ 110.388418236626407, -7.965161134546814, 0.0 ], [ 110.388457559443296, -7.965127818082546, 0.0 ], [ 110.388499764722596, -7.965114476523946, 0.0 ], [ 110.388541932158006, -7.965101215460396, 0.0 ], [ 110.388595000699596, -7.965087831106681, 0.0 ], [ 110.388637153565, -7.965075579530841, 0.0 ], [ 110.388689970607501, -7.965062720233293, 0.0 ], [ 110.388730658568406, -7.965040828104724, 0.0 ], [ 110.3887819864226, -7.965018039234478, 0.0 ], [ 110.388823636224501, -7.965005581299703, 0.0 ], [ 110.388864097142402, -7.964982494773375, 0.0 ], [ 110.388905627723005, -7.964969491042877, 0.0 ], [ 110.3889354057075, -7.96494769881349, 0.0 ], [ 110.388975812454305, -7.96492508169661, 0.0 ], [ 110.389026816489704, -7.964901525110399, 0.0 ], [ 110.389076779090004, -7.964868384017668, 0.0 ], [ 110.389118185958097, -7.964854925789856, 0.0 ], [ 110.389157710684998, -7.964821868377403, 0.0 ], [ 110.389197260185199, -7.964788952456547, 0.0 ], [ 110.389228066569103, -7.964776511741229, 0.0 ], [ 110.389269394972203, -7.964763316306504, 0.0 ], [ 110.389319538175101, -7.964729573445013, 0.0 ], [ 110.389359819552396, -7.964707132843173, 0.0 ], [ 110.3894001763923, -7.964684389568466, 0.0 ], [ 110.389441576365599, -7.964670677828431, 0.0 ], [ 110.389480761836495, -7.964639204052101, 0.0 ], [ 110.389521600412706, -7.964626922230453, 0.0 ], [ 110.389561475683806, -7.96460524842331, 0.0 ], [ 110.389601296000905, -7.964583604532695, 0.0 ], [ 110.389653124317505, -7.96458012314016, 0.0 ], [ 110.389694403187306, -7.964577481011752, 0.0 ], [ 110.389714927813301, -7.96457631700462, 0.0 ], [ 110.3897655455539, -7.964563517424509, 0.0 ], [ 110.389827115405296, -7.964548452236873, 0.0 ], [ 110.389889235978302, -7.964532229778767, 0.0 ], [ 110.389961506876006, -7.964515395561318, 0.0 ], [ 110.3900022104892, -7.964502171166258, 0.0 ], [ 110.390053379477195, -7.964498283986024, 0.0 ], [ 110.390104596329095, -7.964494123378438, 0.0 ], [ 110.390165946757904, -7.964489069673741, 0.0 ], [ 110.390216600313394, -7.964475062690029, 0.0 ], [ 110.390267482514702, -7.964460683577275, 0.0 ], [ 110.390318594950799, -7.964435732764815, 0.0 ], [ 110.390359662029297, -7.964421687074241, 0.0 ], [ 110.390400755978703, -7.964407613628168, 0.0 ], [ 110.390441648229896, -7.964393804133731, 0.0 ], [ 110.390420810599906, -7.964385974243038, 0.0 ], [ 110.390369085556202, -7.964381012814862, 0.0 ], [ 110.3903175971449, -7.964385820763769, 0.0 ], [ 110.390296978394204, -7.964387746018855, 0.0 ], [ 110.390223815760393, -7.964374989988409, 0.0 ], [ 110.390182156412394, -7.964368738163901, 0.0 ], [ 110.390150732828204, -7.964361578372831, 0.0 ], [ 110.390087143976203, -7.964326712358766, 0.0 ], [ 110.390023182086907, -7.96430233621384, 0.0 ], [ 110.389980239009105, -7.964286225092117, 0.0 ], [ 110.389914816075503, -7.964252287259105, 0.0 ], [ 110.389849699651805, -7.964228033201629, 0.0 ], [ 110.389795394654499, -7.964201465751115, 0.0 ], [ 110.389741288919794, -7.964185264601364, 0.0 ], [ 110.3896862536632, -7.964158829473726, 0.0 ], [ 110.389633062634104, -7.964150618019518, 0.0 ], [ 110.389590292676502, -7.964141561743958, 0.0 ], [ 110.389525050684, -7.964110890867089, 0.0 ], [ 110.389447550444203, -7.964083721340602, 0.0 ], [ 110.389402510407805, -7.964066136336297, 0.0 ], [ 110.389346036626193, -7.964050992654417, 0.0 ], [ 110.389311116574206, -7.964034773813927, 0.0 ], [ 110.386559967111907, -7.962310729943339, 0.0 ] // titik terakhir dari GeoJSON
];
// RT 06
const geo_rt06 = [ [ 110.388063199381705, -7.965531689541096, 0.0 ], [ 110.388396967227095, -7.965952000993537, 0.0 ], [ 110.38902313538, -7.966430009527055, 0.0 ], [ 110.389491093345001, -7.966486825606776, 0.0 ], [ 110.390216863077299, -7.966407765364555, 0.0 ], [ 110.390524639347703, -7.966231939483134, 0.0 ], [ 110.390874506391796, -7.966094755411116, 0.0 ], [ 110.3908310325033, -7.965788442593233, 0.0 ], [ 110.390789948606894, -7.965517989425151, 0.0 ], [ 110.390889807985303, -7.965286992824546, 0.0 ], [ 110.391003511861996, -7.964846155046562, 0.0 ], [ 110.391012725435701, -7.964656963207705, 0.0 ], [ 110.3909404120554, -7.964568593846228, 0.0 ], [ 110.3909600898386, -7.96436896915277, 0.0 ], [ 110.390920627389306, -7.964224396854943, 0.0 ], [ 110.390709537353999, -7.964280442103672, 0.0 ], [ 110.390562641225799, -7.964323221533671, 0.0 ], [ 110.390384149496796, -7.964379652841584, 0.0 ], [ 110.389576225697198, -7.964561764686763, 0.0 ], [ 110.388679885094604, -7.965068569923374, 0.0 ], [ 110.388459439007903, -7.965127323148901, 0.0 ], [ 110.388262931392504, -7.965262516376206, 0.0 ], [ 110.388151808315399, -7.96538306232273, 0.0 ], [ 110.3880585587507, -7.965494729358229, 0.0 ], [ 110.388063199381705, -7.965531689541096, 0.0 ] ];

const geo_014B = [ [ 110.386602390225093, -7.962336488114575, 0.0 ], [ 110.386860980797195, -7.962125067130805, 0.0 ], [ 110.387097393022998, -7.96193204758247, 0.0 ], [ 110.387333767294294, -7.961818177609489, 0.0 ], [ 110.387671773079802, -7.961798760700768, 0.0 ], [ 110.388061481737594, -7.961861305673332, 0.0 ], [ 110.388353290573207, -7.961859518938454, 0.0 ], [ 110.388742463198795, -7.961730933712091, 0.0 ], [ 110.3889878193675, -7.961595578971917, 0.0 ], [ 110.389086428019098, -7.961853570365616, 0.0 ], [ 110.389281144304206, -7.962139785290952, 0.0 ], [ 110.3894786063792, -7.962358801390961, 0.0 ], [ 110.389640967422395, -7.962560829197226, 0.0 ], [ 110.389928936654201, -7.962687655749723, 0.0 ], [ 110.390116830027907, -7.962971085353497, 0.0 ], [ 110.390431268098794, -7.963146123625917, 0.0 ], [ 110.390213047048107, -7.963403461390719, 0.0 ], [ 110.390303372015694, -7.963614897736286, 0.0 ], [ 110.390263164849301, -7.963825040424059, 0.0 ], [ 110.390116503101297, -7.964027704055758, 0.0 ], [ 110.390308982480704, -7.964144100626844, 0.0 ], [ 110.390392353597903, -7.964388365608593, 0.0 ], [ 110.390152400846603, -7.964363029478724, 0.0 ], [ 110.389681837336596, -7.964156164053245, 0.0 ], [ 110.389339525129898, -7.964041223297968, 0.0 ], [ 110.388916362313495, -7.963804379285533, 0.0 ], [ 110.388696016983801, -7.963669959806867, 0.0 ], [ 110.388299284940899, -7.963389987680592, 0.0 ], [ 110.387605460872393, -7.962951543467415, 0.0 ], [ 110.386662820248205, -7.962363001686557, 0.0 ], [ 110.386602390225093, -7.962336488114575, 0.0 ]
];

// Susun batasRT untuk Leaflet
const batasRT = [
  { area: fromGeoJson(geo_rt01), color: "#005eff", fill: "#bbdeff", name: "RT 01" },
  { area: fromGeoJson(geo_rt02), color: "#fb5a00", fill: "#ffd2b9", name: "RT 02" },
  { area: fromGeoJson(geo_rt03), color: "#c700ff", fill: "#e7bcff", name: "RT 03" },
  { area: fromGeoJson(geo_014B), color: "#00ff00", fill: "#ffc3de", name: "014B" },
  { area: fromGeoJson(geo_rt04), color: "#000000", fill: "#ffc3de", name: "RT 04" },
  { area: fromGeoJson(geo_rt05), color: "#ff0000", fill: "#ffc3de", name: "RT 05" },
  { area: fromGeoJson(geo_rt06), color: "#ff0099", fill: "#ffc3de", name: "RT 06" },
];

// Render RT
batasRT.forEach((rt) => {
  L.polygon(rt.area, {
    color: rt.color,
    fillColor: rt.fill,
    fillOpacity: 0.25,
    dashArray: "3",
  })
    .addTo(window._desaMap)
    .bindPopup(rt.name);
});





        L.marker(CENTER)
          .addTo(window._desaMap)
          .bindPopup("<b>Rumah Bapak Dukuh Juari</b>");
      }
      // kelola berita

      // 2. FORM CRUD ADMIN
      // === FORM KELOLA BERITA/ARTIKEL ===
// FORM KELOLA BERITA/ARTIKEL - Kirim ke Google Sheets (versi baru)
// FORM KELOLA BERITA/ARTIKEL - versi baru (otomatis konversi link Drive)
document.getElementById('formBerita').onsubmit = async function (e) {
  e.preventDefault();
  const fd = new FormData(e.target);

  const judul    = fd.get('title')    || '';
  const penulis  = fd.get('author')   || '';
  const kategori = fd.get('kategori') || 'berita';
  const tanggal  = fd.get('date')     || new Date().toISOString().slice(0, 10);
  const isi      = fd.get('desc')     || '';

  const rawUrl     = fd.get('urlGambar') || '';
  const linkGambar = normalisasiLinkDrive(rawUrl);   // â† konversi otomatis

  const data = {
    Judul:    judul,
    Penulis:  penulis,
    Kategori: kategori,
    Tanggal:  tanggal,
    Isi:      isi,
    Gambar:   linkGambar          // sudah dalam bentuk uc?export=view&id=ID
  };

  try {
    await apiTambah(data, 'Berita');
    e.target.reset();
    await tampilDaftarBeritaAdminSheets();
    await renderBeritaSheets();
    await renderArtikelSheets();
    await renderRingkasanBerandaSheets();
    alert('Berita/Artikel berhasil ditambah!');
  } catch (err) {
    console.error('Gagal tambah data Berita:', err);
    alert('Gagal menyimpan ke spreadsheet.');
  }
};

function normalisasiLinkDrive(url) {
  if (!url) return "";

  url = url.trim();

  // Jika sudah format direct image, pakai apa adanya
  if (url.includes("uc?export=view")) return url;

  // Jika link share standar: /file/d/ID/...
  const match = url.match(/\/file\/d\/([^/]+)\//);
  if (match && match[1]) {
    const id = match[1];
    return `https://drive.google.com/uc?export=view&id=${id}`;
  }

  // Bukan link Drive â†’ biarkan, bisa jadi URL dari tempat lain
  return url;
}


      // 3. RENDER BERITA/ARTIKEL KE GRID MASING-MASING
      async function renderBeritaSheets() {
  const grid = document.getElementById("beritaGrid");
  if (!grid) return;

  try {
    const data = await apiBaca('Berita');        // baca from Sheets
    const berita = data.filter(d => d.Kategori === 'berita');

    if (!berita.length) {
      grid.innerHTML = "<em>Belum ada berita.</em>";
      return;
    }

    grid.innerHTML = berita.map(d => `
      <div class="berita-card">
        <img src="${d.Gambar || 'https://via.placeholder.com/600x300'}" class="berita-img" alt="${d.Judul || ''}">
        <div class="berita-body">
          <h3 class="berita-title">${d.Judul || ''}</h3>
          <div class="berita-meta">
            ${d.Tanggal || ''}${d.Penulis ? " | " + d.Penulis : ""}
          </div>
          <p class="berita-desc">${(d.Isi || '').slice(0, 160)}...</p>
          <!-- kalau mau ada link detail, tambahkan di sini -->
        </div>
      </div>
    `).join("");
  } catch (e) {
    console.error('Gagal renderBeritaSheets:', e);
    grid.innerHTML = "<em>Gagal memuat berita.</em>";
  }
}


async function renderArtikelSheets() {
  const grid = document.getElementById("artikelGrid");
  if (!grid) return;

  try {
    const data = await apiBaca('Berita');
    const artikel = data.filter(d => d.Kategori === 'artikel');

    if (!artikel.length) {
      grid.innerHTML = "<em>Belum ada artikel.</em>";
      return;
    }

    grid.innerHTML = artikel.map(d => `
      <div class="artikel-card">
        <img src="${d.Gambar || 'https://via.placeholder.com/600x260'}" class="artikel-img" alt="${d.Judul || ''}">
        <div class="artikel-body">
          <h3 class="artikel-title">${d.Judul || ''}</h3>
          <div class="artikel-meta">
            ${d.Tanggal || ''}${d.Penulis ? " | " + d.Penulis : ""}
          </div>
          <p class="artikel-desc">${(d.Isi || '').slice(0, 160)}...</p>
        </div>
      </div>
    `).join("");
  } catch (e) {
    console.error('Gagal renderArtikelSheets:', e);
    grid.innerHTML = "<em>Gagal memuat artikel.</em>";
  }
}


      // 4. ADMIN TABEL LIST & HAPUS
      async function tampilDaftarBeritaAdminSheets() {
  const tbody = document.querySelector('#daftarBeritaAdmin tbody');
  if (!tbody) return;

  try {
    const data = await apiBaca('Berita');

    if (!data.length) {
      tbody.innerHTML =
        '<tr><td colspan="6" style="text-align:center;">Belum ada data.</td></tr>';
      return;
    }

    tbody.innerHTML = data.map((row, i) => {
      const link = row.Gambar || "";
      let preview = "";

      if (link) {
  const lower = link.toLowerCase();

  // 1) Gambar (termasuk direct image Drive)
  if (
    lower.match(/\.(jpg|jpeg|png|gif|webp)$/) ||
    lower.includes("uc?export=view") ||
    lower.includes("googleusercontent.com")
  ) {
    lampiranHtml = `<img src="${link}" alt="${judul}">`;
  }
  // 2) PDF
  else if (lower.endsWith(".pdf")) {
    lampiranHtml = `
      <embed src="${link}#toolbar=0&navpanes=0&scrollbar=0"
             type="application/pdf">
    `;
  }
  // 3) Word/Excel/Drive â†’ Docs Viewer
  else if (
    lower.endsWith(".doc") ||
    lower.endsWith(".docx") ||
    lower.endsWith(".xls") ||
    lower.endsWith(".xlsx") ||
    lower.includes("drive.google.com")
  ) {
    const viewerUrl =
      "https://docs.google.com/viewer?url=" +
      encodeURIComponent(link) +
      "&embedded=true";
    lampiranHtml = `<iframe src="${viewerUrl}" loading="lazy"></iframe>`;
  }
  // 4) Lainnya â†’ link biasa
  else {
    lampiranHtml =
      `<a href="${link}" target="_blank" style="font-size:12px">Lihat lampiran</a>`;
  }
}


      return `
        <tr>
          <td>${i + 1}</td>
          <td>${row.Judul || ''}</td>
          <td>${row.Kategori || ''}</td>
          <td>${preview}</td>
          <td>${row.Tanggal || ''}</td>
          <td>
            <button onclick="hapusData(${row.id}, 'Berita')" class="btn btn-danger">
              Hapus
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } catch (e) {
    console.error('Gagal tampilDaftarBeritaAdminSheets:', e);
  }
}


async function hapusData(id, sheetName) {
  if (!confirm('Yakin hapus data ini?')) return;
  await apiHapus(id, sheetName);

  if (sheetName === 'Berita') {
    tampilDaftarBeritaAdminSheets();
    renderBeritaSheets();
    renderArtikelSheets();
    renderRingkasanBerandaSheets();
  }
  if (sheetName === 'Kependudukan') {
    renderTable();
  }
}




      function showSection(sectionId) {
        // Sembunyikan semua section
        document
          .querySelectorAll(".main-section")
          .forEach((s) => (s.style.display = "none"));

        // Tampilkan section yang dipilih
        const sec = document.getElementById(sectionId);
        if (sec) sec.style.display = "block";

        // === MENU LAIN ===
        if (sectionId === "beritaSection") renderBeritaSheets();
        if (sectionId === "artikelSection") renderArtikelSheets();
        if (sectionId === "kelolaberitaSection") tampilDaftarBeritaAdminSheets();


        if (sectionId === "kependudukan") {
          dataDusun = ambilDataDusun(); // kalau sudah pakai storage dusun
          updateTable();
        }

        if (sectionId === "suratDinas") renderDaftarSurat();
        if (sectionId === "mapsdesaSection") {
          renderMapKajorKulon && renderMapKajorKulon();
        }
      }

      function kirimKeSpreadsheet(dataPenduduk) {
        // GANTI DENGAN URL WEB APP ANDA!
        const url =
          "https://script.google.com/macros/s/AKfycbxOqJCiqdJyqgTx-CHPR3UFyJcpNVX3xosI_NXayHOiKQ_P_aelAr9hPFu1YZsr2hDJ/exec";
        const params = new URLSearchParams(dataPenduduk).toString();
        fetch(url + "?" + params)
          .then((response) => response.text())
          .then((result) => {
            if (result === "OK") {
              alert("Data berhasil terkirim!");
            } else {
              alert("Gagal menyimpan data.");
            }
          })
          .catch((error) => {
            alert("Terjadi error koneksi: " + error.message);
          });
      }

      document
        .getElementById("form-modal")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const dataPenduduk = {};
          Array.from(e.target.elements).forEach((el) => {
            if (el.name) dataPenduduk[el.name] = el.value;
          });
          kirimKeSpreadsheet(dataPenduduk);
        });

      function savePengaturanSurat(e) {
        e.preventDefault();
        let f = e.target;
        let surat = {
          nama: f.nama.value,
          kode: f.kode.value,
          lampiran: f.lampiran.value,
          perihal: f.perihal.value,
          isi: f.isi.value,
        };
        if (editingIdx != null) {
          daftarSurat[editingIdx] = surat;
        } else {
          daftarSurat.push(surat);
        }
        localStorage.setItem("daftarSuratDinas", JSON.stringify(daftarSurat));
        hideModalPengaturan();
        renderDaftarSurat();

        // PATCH BEGIN - Tambahkan di sini!
        fetch(
          "https://script.google.com/macros/s/AKfycbxOqJCiqdJyqgTx-CHPR3UFyJcpNVX3xosI_NXayHOiKQ_P_aelAr9hPFu1YZsr2hDJ/exec?sheet=suratdinas&action=tambah&" +
            new URLSearchParams(surat)
        )
          .then((r) => r.text())
          .then((result) => {
            // Jika ingin alert only on fail:
            if (result !== "OK") alert("Gagal simpan ke spreadsheet!");
          });
        // PATCH END
      }

      // === BERITA & ARTIKEL DI BERANDA ===
      

      const loader = document.getElementById('pageLoader');

function showSection(sectionId){
  if(loader) loader.style.display = 'flex';

  setTimeout(() => {
    document.querySelectorAll('.main-section')
      .forEach(s => s.style.display = 'none');

    const sec = document.getElementById(sectionId);
    if(sec) sec.style.display = 'block';

    if(sectionId === 'beritaSection') renderBeritaSheets();
    if(sectionId === 'artikelSection') renderArtikelSheets();
    if(sectionId === 'suratDinas') renderDaftarSurat();
    if(sectionId === 'mapsdesaSection' && typeof renderMapKajorKulon==='function'){
      renderMapKajorKulon();
    }


    if(loader) loader.style.display = 'none';
  }, 500); // durasi loading 0,5 s
}

// === STORAGE BERITA/ARTIKEL (LOCALSTORAGE) ===
// === DATA BERITA DI LOCALSTORAGE ===
// === DATA BERITA DI LOCALSTORAGE ===
const KEY_BERITA = "kajor_berita";

function ambilDataBerita() {
  try {
    return JSON.parse(localStorage.getItem(KEY_BERITA)) || [];
  } catch (e) {
    return [];
  }
}

function simpanDataBerita(arr) {
  localStorage.setItem(KEY_BERITA, JSON.stringify(arr));
}

// === FORM KELOLA BERITA/ARTIKEL ===
document.getElementById("formBerita").onsubmit = async function (e) {
  e.preventDefault();
  const fd = new FormData(e.target);

  const judul    = fd.get("title")    || "";
  const penulis  = fd.get("author")   || "";
  const kategori = fd.get("kategori") || "berita";
  const tanggal  = fd.get("date")     || new Date().toISOString().slice(0, 10);
  const isi      = fd.get("desc")     || "";

  const rawUrl     = fd.get("urlGambar") || "";
  const linkGambar = normalisasiLinkDrive(rawUrl);   // â† SATU BARIS KONVERSI

  const data = {
    Judul:    judul,
    Penulis:  penulis,
    Kategori: kategori,
    Tanggal:  tanggal,
    Isi:      isi,
    Gambar:   linkGambar               // sudah jadi uc?export=view&id=ID
  };

  try {
    await apiTambah(data, "Berita");
    e.target.reset();
    await tampilDaftarBeritaAdminSheets();
    await renderBeritaSheets();
    await renderArtikelSheets();
    await renderRingkasanBerandaSheets();
    alert("Berita/Artikel berhasil ditambah!");
  } catch (err) {
    console.error("Gagal tambah data Berita:", err);
    alert("Gagal menyimpan ke spreadsheet.");
};


  if (file && file.size > 0) {
    const reader = new FileReader();
    reader.onload = function (ev) {
      prosesSimpan(ev.target.result, file.type); // Base64 + mime type
    };
    reader.readAsDataURL(file);
  } else {
    prosesSimpan();
  }
};


// === TABEL ADMIN BERITA ===
function tampilDaftarBeritaAdminSheets() {
  const data = ambilDataBerita();
  const tbody = document.querySelector("#daftarBeritaAdmin tbody");
  if (!tbody) return;

  tbody.innerHTML = "";

  data.forEach((d, i) => {
    let preview = "";
    if (d.lampiranDataUrl) {
      if (d.lampiranType && d.lampiranType.startsWith("image/")) {
        preview = `<img src="${d.lampiranDataUrl}"
                        style="width:70px;height:50px;object-fit:cover;border-radius:4px;">`;
      } else if (d.lampiranType === "application/pdf") {
        preview = `<span style="font-size:12px;color:#166b4b;">PDF</span>`;
      } else {
        preview = `<a href="${d.lampiranDataUrl}" target="_blank" style="font-size:12px;">File</a>`;
      }
    } else {
      preview = `<span style="font-size:12px;color:#aaa;">-</span>`;
    }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${d.judul || "-"}</td>
      <td>${d.kategori || "-"}</td>
      <td>${preview}</td>
      <td>${d.tanggal || "-"}</td>
      <td><button onclick="hapusBerita(${i})">Hapus</button></td>
    `;
    tbody.appendChild(tr);
  });
}


// === RINGKASAN BERITA DI BERANDA ===
function formatTanggalISO(iso) {
  if (!iso) return '';
  const d = new Date(iso);
  if (isNaN(d)) return iso; // kalau bukan format ISO, tampilkan apa adanya
  return d.toLocaleDateString('id-ID', {
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  });
}


// ==========================
// MINI BERITA & ARTIKEL BERANDA â€“ DARI SHEET "Berita"
// ==========================
async function renderRingkasanBerandaSheets() {
  const miniBerita = document.getElementById("miniBeritaList");
  const miniArtikel = document.getElementById("miniArtikelList");
  if (!miniBerita || !miniArtikel) return;

  try {
    const data = await apiBaca("Berita"); // tab Berita di Sheets

    data.sort((a, b) => new Date(b.Tanggal) - new Date(a.Tanggal));

    const berita = data.filter((d) => d.Kategori === "berita").slice(0, 6);
    const artikel = data.filter((d) => d.Kategori === "artikel").slice(0, 6);

    const buatItem = (d) => {
      const isi = d.Isi || "";
      const ringkas = isi.length > 120 ? isi.slice(0, 120) + "..." : isi;
      const judul = d.Judul || "(Tanpa judul)";
      const meta =
        (d.Tanggal ? formatTanggalISO(d.Tanggal) : "") +
        (d.Penulis ? " | " + d.Penulis : "");

      const link = (d.Gambar || "").trim();
      let lampiranHtml = "";

      if (link) {
  const lower = link.toLowerCase();

  // 1) Gambar (termasuk link Google Drive direct image)
  if (
    lower.match(/\.(jpg|jpeg|png|gif|webp)$/) ||
    lower.includes("uc?export=view") ||
    lower.includes("googleusercontent.com")
  ) {
    lampiranHtml = `<img src="${link}" alt="${judul}">`;
  }
  // 2) PDF
  else if (lower.endsWith(".pdf")) {
    lampiranHtml = `
      <embed src="${link}#toolbar=0&navpanes=0&scrollbar=0"
             type="application/pdf">
    `;
  }
  // 3) Word/Excel/Google Drive â†’ Google Docs Viewer
  else if (
    lower.endsWith(".doc") ||
    lower.endsWith(".docx") ||
    lower.endsWith(".xls") ||
    lower.endsWith(".xlsx") ||
    lower.includes("drive.google.com")
  ) {
    const viewerUrl =
      "https://docs.google.com/viewer?url=" +
      encodeURIComponent(link) +
      "&embedded=true";
    lampiranHtml = `<iframe src="${viewerUrl}" loading="lazy"></iframe>`;
  }
  // 4) Lainnya â†’ link biasa
  else {
    lampiranHtml = `<a href="${link}" target="_blank" style="font-size:12px">Lihat lampiran</a>`;
  }
}

function normalisasiLinkDrive(url) {
  if (!url) return "";

  url = url.trim();
  if (url.includes("uc?export=view")) return url;

  // tangkap ID baik ada / di belakang maupun tidak
  const match = url.match(/\/file\/d\/([^/]+)/);
  if (match && match[1]) {
    const id = match[1];
    return `https://drive.google.com/uc?export=view&id=${id}`;
  }

  return url;
}

      return `
        <div class="mini-berita-item">
          ${lampiranHtml}
          <div class="mini-berita-title">${judul}</div>
          <div class="mini-berita-meta">${meta}</div>
          <div class="mini-berita-text">${ringkas}</div>
        </div>
      `;
    };

    miniBerita.innerHTML = berita.length
      ? berita.map(buatItem).join("")
      : "<em>Belum ada berita.</em>";

    miniArtikel.innerHTML = artikel.length
      ? artikel.map(buatItem).join("")
      : "<em>Belum ada artikel.</em>";
  } catch (e) {
    console.error("Gagal renderRingkasanBerandaSheets:", e);
  }
}



// ==========================
// KEPENDUDUKAN â€“ GOOGLE SHEETS
// ==========================

// dipakai nanti kalau mau buat fitur Edit
let currentEditIndex = null;

// DIPANGGIL dari form: <form id="admin-form" onsubmit="saveData(event)">
async function saveData(event) {
  event.preventDefault();
  const form = event.target;

  // NAMA PROPERTI = HEADER di sheet "Kependudukan"
  const entry = {
    Dusun: form.dusun.value,
    NIK: form.nik.value,
    RW: form.rw.value,
    RT: form.rt.value,
    KK: form.kk.value,
    LP: form.lp.value,
    L: form.l.value,
    P: form.p.value
  };

  try {
    await apiTambah(entry, 'Kependudukan');   // simpan ke Google Sheets
    closeForm();                              // tutup modal
    await renderTable();                      // reload tabel
    alert('Data kependudukan tersimpan.');
  } catch (err) {
    console.error(err);
    alert('Gagal menyimpan data kependudukan.');
  }
}

// AMBIL & TAMPILKAN TABEL dari Sheets
async function renderTable() {
  try {
    const dataDusun = await apiBaca('Kependudukan'); // ambil semua baris

    const tbody = document.getElementById('table-body');
    if (!tbody) return;

    // isi baris tabel
    tbody.innerHTML = dataDusun.map((row, i) => `
      <tr>
        <td>${i + 1}</td>
        <td>
          <button class="btn btn-blue" onclick="alert('Edit belum dibuat')">
            Edit
          </button>
          <button class="btn btn-danger" onclick="hapusData(${row.id}, 'Kependudukan')">
            Hapus
          </button>
        </td>
        <td>${row.Dusun || ''}</td>
        <td>${row.NIK || ''}</td>
        <td>${row.RW || ''}</td>
        <td>${row.RT || ''}</td>
        <td>${row.KK || ''}</td>
        <td>${row.LP || ''}</td>
        <td>${row.L || ''}</td>
        <td>${row.P || ''}</td>
      </tr>
    `).join('');

    // HITUNG TOTAL
    const totalNIK = dataDusun.reduce((s, r) => s + (parseInt(r.NIK || 0) || 0), 0);
    const totalRW  = dataDusun.reduce((s, r) => s + (parseInt(r.RW  || 0) || 0), 0);
    const totalRT  = dataDusun.reduce((s, r) => s + (parseInt(r.RT  || 0) || 0), 0);
    const totalKK  = dataDusun.reduce((s, r) => s + (parseInt(r.KK  || 0) || 0), 0);
    const totalLP  = dataDusun.reduce((s, r) => s + (parseInt(r.LP  || 0) || 0), 0);
    const totalL   = dataDusun.reduce((s, r) => s + (parseInt(r.L   || 0) || 0), 0);
    const totalP   = dataDusun.reduce((s, r) => s + (parseInt(r.P   || 0) || 0), 0);

    document.getElementById('total-nik').textContent = totalNIK;
    document.getElementById('total-rw').textContent  = totalRW;
    document.getElementById('total-rt').textContent  = totalRT;
    document.getElementById('total-kk').textContent  = totalKK;
    document.getElementById('total-lp').textContent  = totalLP;
    document.getElementById('total-l').textContent   = totalL;
    document.getElementById('total-p').textContent   = totalP;
  } catch (e) {
    console.error('Gagal renderTable kependudukan:', e);
  }
}

// HAPUS 1 BARIS di Sheets
async function hapusData(id, sheetName) {
  if (!confirm('Yakin hapus data ini?')) return;
  await apiHapus(id, sheetName);
  await renderTable();
}

// BUKA / TUTUP MODAL FORM (sesuai HTML kamu)
function showForm() {
  const modal = document.getElementById('form-modal');
  if (modal) modal.style.display = 'flex';
}

function closeForm() {
  const modal = document.getElementById('form-modal');
  if (modal) modal.style.display = 'none';
  const form = document.getElementById('admin-form');
  if (form) form.reset();
}

// ==========================
// BERITA / ARTIKEL â€“ GOOGLE SHEETS (TAB: Berita)
// ==========================

// SIMPAN dari form Kelola Berita
async function handleFormBerita(e) {
  e.preventDefault();
  const fd = new FormData(e.target);

  const judul    = fd.get("title")   || "";
  const penulis  = fd.get("author")  || "";
  const kategori = fd.get("kategori")|| "berita";
  const tanggal  = fd.get("date")    || new Date().toISOString().slice(0, 10);
  const isi      = fd.get("desc")    || "";
  const urlGambar = fd.get("urlGambar") || ""; // input text URL gambar

  const data = {
    Judul:   judul,
    Penulis: penulis,
    Kategori: kategori,
    Tanggal: tanggal,
    Isi:     isi,
    Gambar:  urlGambar          // â† inilah yang nanti terbaca sebagai row.Gambar
  };

  await apiTambah(data, "Berita");
  e.target.reset();
  tampilDaftarBeritaAdminSheets();
  renderBeritaSheets();
  renderArtikelSheets();
  renderRingkasanBerandaSheets();
}


// RENDER daftar berita di admin (tabel #daftarBeritaAdmin tbody)
async function tampilDaftarBeritaAdminSheets() {
  const tbody = document.querySelector('#daftarBeritaAdmin tbody');
  if (!tbody) return;

  try {
    const data = await apiBaca('Berita');

    if (!data.length) {
      tbody.innerHTML =
        '<tr><td colspan="6" style="text-align:center;">Belum ada data.</td></tr>';
      return;
    }

    tbody.innerHTML = data.map((row, i) => {
      const link = row.Gambar || "";
let preview = "";

if (link) {
  // 1) Gambar: langsung tampilkan thumbnail (klik untuk perbesar di tab baru)
  if (link.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
    preview = `
      <a href="${link}" target="_blank">
        <img src="${link}"
             style="width:90px;height:60px;object-fit:cover;border-radius:4px;">
      </a>`;
  }
  // 2) PDF: embed langsung di cell (mini viewer)
  else if (link.toLowerCase().endsWith(".pdf")) {
    preview = `
      <embed src="${link}#toolbar=0&navpanes=0&scrollbar=0"
             type="application/pdf"
             style="width:120px;height:80px;border:1px solid #ccc;border-radius:4px;">
    `;
  }
  // 3) Link lain: masih pakai teks "Buka File"
  else {
    preview = `
      <a href="${link}" target="_blank" style="font-size:12px;">
        Buka File
      </a>`;
  }
} else {
  preview = `<span style="font-size:12px;color:#aaa;">-</span>`;
}

      return `
        <tr>
          <td>${i + 1}</td>
          <td>${row.Judul || ''}</td>
          <td>${row.Kategori || ''}</td>
          <td>${preview}</td>
          <td>${row.Tanggal || ''}</td>
          <td>
            <button onclick="hapusData(${row.id}, 'Berita')" class="btn btn-danger">
              Hapus
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } catch (e) {
    console.error('Gagal tampilDaftarBeritaAdminSheets:', e);
  }

  function normalisasiLinkDrive(url) {
  if (!url) return "";

  url = url.trim();
  // Kalau sudah format uc?export=view, langsung pakai
  if (url.includes("uc?export=view")) return url;

  // Kalau format standard /file/d/ID/..., konversi
  const match = url.match(/\/file\/d\/([^/]+)\//);
  if (match && match[1]) {
    const id = match[1];
    return `https://drive.google.com/uc?export=view&id=${id}`;
  }

  return url; // kalau bukan link Drive, biarkan apa adanya
}
}


// ==========================
// MINI BERITA & ARTIKEL BERANDA â€“ DARI SHEET "Berita"
// ==========================
// Format tanggal dari ISO Sheet â†’ 16 Des 2025
function formatTanggalISO(iso) {
  if (!iso) return "";
  const d = new Date(iso);
  if (isNaN(d)) return iso;
  return d.toLocaleDateString("id-ID", {
    day: "2-digit",
    month: "short",
    year: "numeric",
  });
}

// MINI BERITA & ARTIKEL BERANDA â€“ DARI SHEET "Berita"
async function renderRingkasanBerandaSheets() {
  const miniBerita = document.getElementById("miniBeritaList");
  const miniArtikel = document.getElementById("miniArtikelList");
  if (!miniBerita || !miniArtikel) return;

  try {
    const data = await apiBaca("Berita");

    data.sort((a, b) => new Date(b.Tanggal) - new Date(a.Tanggal));

    const berita  = data.filter((d) => d.Kategori === "berita").slice(0, 6);
    const artikel = data.filter((d) => d.Kategori === "artikel").slice(0, 6);

    const buatItem = (d) => {
      const isi    = d.Isi || "";
      const ringkas = isi.length > 120 ? isi.slice(0, 120) + "..." : isi;
      const judul   = d.Judul || "(Tanpa judul)";
      const meta =
        (d.Tanggal ? formatTanggalISO(d.Tanggal) : "") +
        (d.Penulis ? " | " + d.Penulis : "");

      const link = (d.Gambar || "").trim();
      let lampiranHtml = "";

      if (link) {
        const lower = link.toLowerCase();

        // Gambar
        if (lower.match(/\.(jpg|jpeg|png|gif|webp)$/)) {
          lampiranHtml = `<img src="${link}" alt="${judul}">`;
        }
        // PDF
        else if (lower.endsWith(".pdf")) {
          lampiranHtml = `
            <embed src="${link}#toolbar=0&navpanes=0&scrollbar=0"
                   type="application/pdf">
          `;
        }
        // Word / Excel / Google Drive
        else if (
          lower.endsWith(".doc") || lower.endsWith(".docx") ||
          lower.endsWith(".xls") || lower.endsWith(".xlsx") ||
          lower.includes("drive.google.com")
        ) {
          const viewerUrl =
            "https://docs.google.com/viewer?url=" +
            encodeURIComponent(link) +
            "&embedded=true";
          lampiranHtml = `<iframe src="${viewerUrl}" loading="lazy"></iframe>`;
        }
        // Lainnya â†’ link biasa
        else {
          lampiranHtml = `<a href="${link}" target="_blank" style="font-size:12px">Lihat lampiran</a>`;
        }
      }

      return `
        <div class="mini-berita-item">
          ${lampiranHtml}
          <div class="mini-berita-title">${judul}</div>
          <div class="mini-berita-meta">${meta}</div>
          <div class="mini-berita-text">${ringkas}</div>
        </div>
      `;
    };

    miniBerita.innerHTML  = berita.length  ? berita.map(buatItem).join("")  : "<em>Belum ada berita.</em>";
    miniArtikel.innerHTML = artikel.length ? artikel.map(buatItem).join("") : "<em>Belum ada artikel.</em>";
  } catch (e) {
    console.error("Gagal renderRingkasanBerandaSheets:", e);
  }
}


// panggil saat halaman siap
document.addEventListener("DOMContentLoaded", function () {
  showSection("dashboard");

  // --- BERITA / ARTIKEL dari Google Sheets ---
  renderBeritaSheets();
  renderArtikelSheets();
  renderRingkasanBerandaSheets();

  // --- CATATAN WARGA (tetap localStorage, ini nggak masalah) ---
  // initCatatanForm();
  // renderCatatan();

  // --- ADMIN LIST BERITA dari Google Sheets ---
  tampilDaftarBeritaAdminSheets();

  // --- FORM KELola BERITA: simpan ke Sheets ---
  const formBerita = document.getElementById('formBerita');
  if (formBerita) {
    formBerita.onsubmit = handleFormBerita; // kalau kamu sudah buat handler ini
  }
});

  

function renderArtikelSheets() {
  const data = ambilDataBerita().filter(x => x.kategori === "artikel");
  const grid = document.getElementById("artikelGrid");
  grid.innerHTML = data.length
    ? data.map(d => `
      <div class="article-card">
        <img src="${d.img || d.gambar}" alt="${d.title || d.judul}" class="article-img">
        <div class="article-body">
          <div class="article-title">${d.title || d.judul}</div>
          <div class="article-meta">${d.date || d.tanggal} | ${d.author || d.penulis}</div>
          <div class="article-desc">${d.desc || d.isi}</div>
        </div>
      </div>
    `).join("")
    : "<em>Belum ada artikel.</em>";
}

// === STORAGE CATATAN WARGA ===
const KEY_CATATAN = "kajor_catatan_warga";

function ambilCatatan() {
  try {
    return JSON.parse(localStorage.getItem(KEY_CATATAN)) || [];
  } catch (e) {
    return [];
  }
}

// === CATATAN / MASUKAN WARGA (Google Sheets) ===

// render list catatan dari Sheet "Catatan"
async function renderCatatan() {
  const list = document.getElementById("catatanList");
  if (!list) return;

  list.innerHTML = "<div class='catatan-loading'>Memuat catatan...</div>";

  try {
    const data = await apiBaca("Catatan");   // baca dari sheet Catatan

    if (!data.length) {
      list.innerHTML = "";
      const empty = document.createElement("div");
      empty.className = "catatan-empty";
      empty.textContent =
        "Belum ada catatan. Warga dapat mulai menulis saran melalui form di sebelah.";
      list.appendChild(empty);
      return;
    }

    list.innerHTML = "";
    data.forEach((item) => {
      const div = document.createElement("div");
      div.className = "catatan-item";
      div.innerHTML = `
        <div class="catatan-item-header">
          <span>${item.Nama || "Warga"}</span>
          <span>${item.RT ? "RT " + item.RT : ""}</span>
        </div>
        <div class="catatan-item-tanggal">${item.Waktu || ""}</div>
        <div class="catatan-item-isi">${item.Isi || ""}</div>
        <button onclick="hapusCatatan(${item.id})">Hapus</button>
      `;
      list.appendChild(div);
    });
  } catch (e) {
    console.error("Gagal renderCatatan:", e);
    list.innerHTML = "<div class='catatan-error'>Gagal memuat catatan.</div>";
  }
}

// submit form catatan -> simpan ke sheet Catatan
function initCatatanForm() {
  const form = document.getElementById("catatanForm");
  if (!form) return;

  form.onsubmit = async function (e) {
    e.preventDefault();
    const fd = new FormData(form);
    const f = Object.fromEntries(fd.entries());
    if (!f.isi || !f.isi.trim()) return;

    const now = new Date();
    const waktu =
      now.toLocaleDateString("id-ID") +
      " " +
      now.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit" });

    const data = {
      Nama:  f.nama || "",
      RT:    f.rt   || "",
      Isi:   f.isi  || "",
      Waktu: waktu
    };

    try {
      await apiTambah(data, "Catatan");
      form.reset();
      renderCatatan();    // refresh list
    } catch (e2) {
      console.error("Gagal simpan catatan:", e2);
      alert("Gagal menyimpan catatan warga.");
    }
  };
}

// hapus catatan berdasarkan id record di sheet
async function hapusCatatan(id) {
  if (!confirm("Hapus catatan ini?")) return;
  try {
    await apiHapus(id, "Catatan");
    renderCatatan();
  } catch (e) {
    console.error("Gagal hapus catatan:", e);
    alert("Gagal menghapus catatan.");
  }
}

// === AI ANALISIS TUMBUHAN ===
  const plantForm   = document.getElementById('aiPlantForm');
  const plantImage  = document.getElementById('plantImage');
  const uploadZone  = document.getElementById('uploadZone');
  const aiLoading   = document.getElementById('aiLoading');
  const aiResult    = document.getElementById('aiResult');
  const resultDiv   = document.getElementById('resultContent');

  if (uploadZone && plantImage && plantForm) {
    uploadZone.addEventListener('click', () => plantImage.click());

    uploadZone.addEventListener('dragover', e => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', e => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', e => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        plantImage.files = e.dataTransfer.files;
        previewImage(file);
      }
    });

    plantImage.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) previewImage(file);
    });

    plantForm.addEventListener('submit', async e => {
      e.preventDefault();
      const file = plantImage.files[0];
      if (!file) {
        alert('Pilih gambar terlebih dahulu.');
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        alert('Ukuran gambar maksimal 5MB.');
        return;
      }

      showLoading(true);
      try {
        const base64 = await fileToBase64(file);
        const hasil  = await analyzePlantAI(base64);
        tampilkanHasilAI(hasil, file);
      } catch (err) {
        console.error(err);
        alert('Analisis gagal, coba lagi beberapa saat lagi.');
      }
      showLoading(false);
    });
  }

  function showLoading(on) {
    if (!aiLoading || !aiResult) return;
    aiLoading.style.display = on ? 'block' : 'none';
    aiResult.style.display   = on ? 'none'  : 'block';
  }

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload  = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  async function analyzePlantAI(base64Image) {
  const res = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${OPENAI_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'gpt-4.1-mini',
      messages: [{
        role: 'user',
        content: [
          {
            type: 'text',
            text: `Kamu adalah asisten agronomi. Jawab HANYA dalam format JSON valid (tanpa penjelasan lain).

{
  "status": "HIDUP|SAKIT|MATI",
  "kesehatan": 0-100,
  "gejala": "deskripsi gejala singkat",
  "penyebab": "penyebab teknis singkat",
  "solusi": ["langkah 1", "langkah 2", "langkah 3"],
  "kepercayaan": 0-100
}`
          },
          {
            type: 'image_url',
            image_url: { url: base64Image }
          }
        ]
      }],
      max_tokens: 300,
      temperature: 0.1
    })
  });

  const data = await res.json();

  // Ambil teks jawaban
  let content = data?.choices?.[0]?.message?.content || '';

  // Kalau model masih nambah teks sebelum/sesudah JSON, bersihkan
  const start = content.indexOf('{');
  const end   = content.lastIndexOf('}');
  if (start === -1 || end === -1) {
    throw new Error('Response bukan JSON: ' + content);
  }
  const jsonText = content.slice(start, end + 1);

  return JSON.parse(jsonText);
}


  function previewImage(file) {
    const old = uploadZone.querySelector('img');
    if (old) old.remove();

    const reader = new FileReader();
    reader.onload = e => {
      const img = document.createElement('img');
      img.src = e.target.result;
      img.style.cssText = 'width:100%;height:150px;object-fit:cover;border-radius:8px;margin-top:10px;';
      uploadZone.appendChild(img);
    };
    reader.readAsDataURL(file);
  }

  function tampilkanHasilAI(result, file) {
    if (!resultDiv) return;
    const statusClass = `status-${result.status.toLowerCase()}`;
    const fotoUrl = file ? URL.createObjectURL(file) : '';

    resultDiv.innerHTML = `
      <div class="${statusClass}">
        <h3>ðŸ“Š ${result.status} 
          <span class="confidence-badge">Akurasi AI: ${result.kepercayaan || 0}%</span>
        </h3>
        ${fotoUrl ? `<img src="${fotoUrl}" style="width:100%;height:200px;object-fit:cover;border-radius:12px;margin:15px 0;">` : ''}
        <div style="background:#fff;padding:15px;border-radius:10px;margin:15px 0;">
          <p><strong>ðŸ” Gejala:</strong> ${result.gejala}</p>
          <p><strong>ðŸŽ¯ Penyebab:</strong> ${result.penyebab}</p>
          <p><strong>â¤ï¸ Kesehatan:</strong> ${result.kesehatan}%</p>
        </div>
        <div style="background:rgba(255,255,255,0.8);padding:15px;border-radius:10px;">
          <h4>âœ… Solusi untuk Petani:</h4>
          <ul>
            ${(result.solusi || []).map(s => `<li>${s}</li>`).join('')}
          </ul>
        </div>
      </div>
    `;
    aiResult.style.display = 'block';

    // simpan lastResult global untuk dikirim ke Sheets
    window._lastPlantResult = result;
  }

  async function simpanKeRiwayatDesa() {
    const r = window._lastPlantResult;
    if (!r) {
      alert('Belum ada hasil analisis.');
      return;
    }
    const data = {
      Tanggal:   new Date().toLocaleString('id-ID'),
      Status:    r.status,
      Kesehatan: r.kesehatan,
      Gejala:    r.gejala,
      Penyebab:  r.penyebab,
      Solusi:    (r.solusi || []).join('; ')
    };
    try {
      await apiTambah(data, 'AnalisisTumbuhan');
      alert('âœ… Hasil analisis tersimpan ke Google Sheets AnalisisTumbuhan.');
    } catch (e) {
      console.error(e);
      alert('Gagal menyimpan ke Sheets.');
    }
  }

  // === PANEL CUACA & TANAM DUSUN ===
  const OW_API_KEY = '32d40430e3b0250da88ffb265c50672f';
  const DESA_LAT = -7.9629;   // sesuaikan kalau ada koordinat pasti
  const DESA_LON = 110.3864;

  let _lastWeather = null;

document.addEventListener('DOMContentLoaded', () => {
  muatCuacaDanTanam();
  // refresh tiap 15 menit (aman dari limit API)
  setInterval(muatCuacaDanTanam, 15 * 60 * 1000);
});


  async function muatCuacaDanTanam() {
  try {
    const url =
      `https://api.openweathermap.org/data/2.5/weather?lat=${DESA_LAT}&lon=${DESA_LON}&appid=${OW_API_KEY}&units=metric&lang=id`;
    const res = await fetch(url);

    if (!res.ok) {
      console.error('Gagal ambil cuaca. Status:', res.status);
      const badge = document.getElementById('ctBadge');
      if (badge) {
        badge.textContent = res.status === 401
          ? 'API key belum aktif / salah'
          : 'Gagal memuat cuaca';
      }
      return;
    }

    const data = await res.json();
    cekPerubahanCuaca(data);
    isiPanelCuaca(data);
    isiPanelTanam(data);
  } catch (err) {
    console.error(err);
    const badge = document.getElementById('ctBadge');
    if (badge) badge.textContent = 'Gagal memuat';
    const ringkasan = document.getElementById('ctRingkasan');
    if (ringkasan) ringkasan.textContent =
      'Data cuaca belum tersedia. Silakan muat ulang halaman beberapa saat lagi.';
  }
}

  function isiPanelCuaca(d) {
    const now = new Date();
    document.getElementById('ctTanggal').textContent =
      now.toLocaleDateString('id-ID', {
        weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
      });

    const kondisi = d.weather?.[0]?.description || 'â€“';
    const suhu = Math.round(d.main?.temp ?? 0);
    const kelembapan = d.main?.humidity ?? 0;
    const angin = d.wind?.speed ?? 0;
    const hujan = (d.rain && (d.rain['1h'] || d.rain['3h'])) || 0;

    document.getElementById('ctSuhu').textContent = `${suhu}Â°C`;
    document.getElementById('ctKondisi').textContent = kapital(kondisi);
    document.getElementById('ctHujan').textContent = `Hujan: ${hujan} mm`;
    document.getElementById('ctKelembapan').textContent = `Kelembapan: ${kelembapan}%`;
    document.getElementById('ctAngin').textContent = `Angin: ${angin} m/s`;

    const badge = document.getElementById('ctBadge');
    if (!badge) return;
    if (hujan > 1 || kondisi.includes('hujan')) {
      badge.textContent = 'Potensi Hujan';
      badge.style.background = 'rgba(24,186,212,0.18)';
      badge.style.color = '#0c6f8e';
    } else if (suhu >= 32) {
      badge.textContent = 'Panas Terik';
      badge.style.background = 'rgba(255,184,84,0.22)';
      badge.style.color = '#b5620a';
    } else {
      badge.textContent = 'Cuaca Stabil';
      badge.style.background = 'rgba(54,179,126,0.18)';
      badge.style.color = '#14714b';
    }
  }

  function isiPanelTanam(d) {
    const hujan = (d.rain && (d.rain['1h'] || d.rain['3h'])) || 0;
    const kelembapan = d.main?.humidity ?? 0;
    const bulan = new Date().getMonth() + 1;

    const musimHujan = [11,12,1,2,3];
    const musimKemarau = [6,7,8,9];

    let ringkasan, padi, palawija, catatan;

    if (musimHujan.includes(bulan) && (hujan > 1 || kelembapan > 75)) {
      ringkasan = 'Hari ini cenderung basah; cocok untuk fase tanam atau pemeliharaan padi di sawah.';
      padi = 'Disarankan tanam/pindah tanam padi atau pemupukan awal jika bibit sudah di lahan.';
      palawija = 'Tunda tanam palawija baru di lahan yang mudah tergenang, pastikan saluran air baik.';
      catatan = 'Pantau hama/penyakit karena kelembapan tinggi dan bersihkan pematang secara berkala.';
    } else if (musimKemarau.includes(bulan) && hujan === 0 && kelembapan < 70) {
      ringkasan = 'Cuaca relatif kering; baik untuk palawija dan pengeringan hasil panen.';
      padi = 'Tanam padi baru sebaiknya dihindari kecuali irigasi teknis dengan air cukup.';
      palawija = 'Baik untuk jagung, kacang-kacangan, cabai, dan sayur tahan kering disertai penyiraman teratur.';
      catatan = 'Gunakan mulsa, atur jadwal penyiraman pagi/sore, dan jaga ketersediaan air tadah hujan.';
    } else {
      ringkasan = 'Cuaca sedang; aman untuk perawatan tanaman dan tanam terbatas sesuai kondisi lahan.';
      padi = 'Lanjutkan pemeliharaan padi: penyiangan, pemupukan susulan, dan pengamatan hama.';
      palawija = 'Tanam skala kecil dimungkinkan, cek kelembapan tanah di setiap petak.';
      catatan = 'Cek prakiraan beberapa hari ke depan sebelum keputusan tanam besar-besaran.';
    }

    document.getElementById('ctRingkasan').textContent = ringkasan;
    document.getElementById('ctPadi').innerHTML = `<strong>Padi:</strong> ${padi}`;
    document.getElementById('ctPalawija').innerHTML = `<strong>Palawija:</strong> ${palawija}`;
    document.getElementById('ctCatatan').innerHTML = `<strong>Catatan Lapangan:</strong> ${catatan}`;
  }

  function kapital(str) {
    return (str || '').replace(/(^|\s)\S/g, s => s.toUpperCase());
  }
  
  function analisisTanaman(e) {
  // contoh: gambar dikirim sebagai base64 lewat POST body / parameter "image"
  const imgBase64 = e.parameter.image;   // atau baca dari e.postData.contents

  if (!imgBase64) {
    return ContentService
      .createTextOutput(JSON.stringify({ error: 'Gambar tidak dikirim' }))
      .setMimeType(ContentService.MimeType.JSON);
  }

  // TODO: di sini kamu panggil API AI (OpenAI / lain) dari Apps Script,
  // lalu olah hasilnya, misal:
  const hasil = {
    namaTanaman: 'contoh',
    penyakit: 'contoh',
    saran: 'contoh'
  };

  return ContentService
    .createTextOutput(JSON.stringify(hasil))
    .setMimeType(ContentService.MimeType.JSON);
}


  // expose untuk tombol
  window.simpanKeRiwayatDesa = simpanKeRiwayatDesa;


    </script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </body>
</html>